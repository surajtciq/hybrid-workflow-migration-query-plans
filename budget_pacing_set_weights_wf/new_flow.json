{
  "TASK_1__SQL_SEGMENT": [
    {
      "campaigns_fact_table_custom_strategy_builder_for_ds": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds AS SELECT a.client_id, a.profile_id, a.profile_name, a.campaign_id, a.portfolio_id, a.portfolio_name, a.budget_amount, a.campaign_name, a.campaign_type, a.campaign_budget, a.targeting_type, b.base_budget AS daily_budget, a.start_date, a.end_date, a.state_latest, a.serving_status, a.campaign_status, a.state, a.ordered_revenue, a.cost, a.attributedsales14d, a.report_date FROM (SELECT client_id, profile_id, profile_name, campaign_id, portfolio_id, portfolio_name, budget_amount, campaign_name, campaign_type, campaign_budget, targeting_type, daily_budget, state_latest, serving_status, campaign_status, STATE, ordered_revenue, MIN(start_date) AS start_date, COALESCE(MAX(end_date), NULL) AS end_date, SUM(cost) AS cost, SUM(attributedsales14d) AS attributedsales14d, report_date FROM (SELECT * FROM CLIENT_CATALOG.ams_cubes.campaigns_campaign_workbench WHERE client_id = 4703) WHERE NOT LOWER(state_latest) IN ('archived', 'deleted') AND NOT LOWER(serving_status) IN ('ended', 'terminated', 'campaign ended', 'campaign_ended', 'campaign_incomplete', 'campaign archived', 'campaign_archived', 'rejected', 'campaign incomplete', 'ineligible') GROUP BY client_id, profile_id, profile_name, campaign_id, portfolio_id, portfolio_name, budget_amount, campaign_name, campaign_budget, campaign_type, targeting_type, daily_budget, state_latest, serving_status, campaign_status, state, ordered_revenue, report_date) AS a INNER JOIN (SELECT campaign_id, base_budget FROM (SELECT * FROM CLIENT_CATALOG.ams_cubes.campaigns_metadata_v2_view WHERE client_id = 4703)) AS b ON (a.campaign_id = b.campaign_id)"
      ],
      "latest_index_table": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table AS SELECT entity_id AS campaign_id, feed_date, day_index FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_pacing_index_table WHERE client_id = 4703) WHERE entity_type = 'CAMPAIGN' AND YEAR(CAST(feed_date AS DATE)) = YEAR(CAST(2025-07-30 AS DATE)) AND version_date = (SELECT MAX(version_date) FROM CLIENT_CATALOG.aramus_ds.budget_pacing_index_table WHERE client_id = 4703 AND YEAR(TO_DATE(feed_date)) = YEAR(TO_DATE(2025-07-30)))"
      ],
      "latest_index_table_profile": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table_profile",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table_profile AS SELECT entity_id AS profile_id, feed_date, day_index FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_pacing_index_table WHERE client_id = 4703) WHERE entity_type = 'PROFILE' AND YEAR(TO_DATE(feed_date)) = YEAR(TO_DATE(2025-07-30)) AND version_date = (SELECT MAX(version_date) FROM CLIENT_CATALOG.aramus_ds.budget_pacing_index_table WHERE client_id = 4703 AND YEAR(TO_DATE(feed_date)) = YEAR(TO_DATE(2025-07-30)))"
      ],
      "budget_version_payload_latest": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__budget_version_payload_latest",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__budget_version_payload_latest AS (SELECT client_id, plan_version_id, REPLACE(payload, '|', '-') AS payload, creation_time FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_version_payload WHERE client_id = 4703) WHERE creation_time = (SELECT MAX(creation_time) FROM CLIENT_CATALOG.aramus_ds.budget_version_payload WHERE client_id = 4703 AND YEAR(creation_time) = YEAR(CAST(2025-07-30 AS DATE))) LIMIT 1) UNION ALL SELECT '-1' AS client_id, '-1' AS plan_version_id, CAST(NULL AS STRING) AS payload, '1970-1-1' AS creation_time"
      ],
      "plan_created_check": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__plan_created_check",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__plan_created_check AS SELECT 4703 AS client_id, COUNT(*) AS no_of_plans FROM CLIENT_CATALOG.aramus_ds.budget_version_payload WHERE client_id = 4703 AND YEAR(CAST(2025-07-30 AS DATE)) = YEAR(creation_time)"
      ]
    },
    {
      "active_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__active_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__active_campaigns AS SELECT profile_id, profile_name, campaign_id, portfolio_id, portfolio_name, budget_amount AS portfolio_budget, campaign_type, targeting_type, daily_budget, start_date, end_date, state_latest, serving_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE LOWER(state_latest) IN ('enabled', 'paused') AND NOT daily_budget IS NULL AND client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD') AND report_date = (SELECT MAX(report_date) FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD')) AND (end_date IS NULL OR end_date > (SELECT MAX(report_date) FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD'))) UNION ALL SELECT '-1' AS profile_id, '-1' AS profile_name, '-1' AS campaign_id, '-1' AS portfolio_id, '-1' AS portfolio_name, -1 AS portfolio_budget, '-1' AS campaign_type, '-1' AS targeting_type, -1 AS daily_budget, '1970-01-01' AS start_date, '1970-01-01' AS end_date, '-1' AS state_latest, '-1' AS serving_status"
      ],
      "existing_sd_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sd_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sd_campaigns AS SELECT 4703 AS client_id, CAST(2025-07-30 AS DATE) AS feed_date, t1.profile_id, profile_name, CAST(NULL AS STRING) AS portfolio_id, CAST(NULL AS STRING) AS portfolio_name, CAST(NULL AS STRING) AS targeting_type, CAST(NULL AS DECIMAL (38, 5)) AS daily_budget, CAST(t1.campaign_id AS STRING) AS campaign_id, 'SD' AS campaign_type, t2.weight, 1 AS spend_expected, 0 AS enable_pacing, 0 AS enable_reallocation, 'EXISTING_COMPLETE_CAMPAIGN' AS campaign_tracker_status, CAST(NULL AS DATE) AS start_date, CAST(NULL AS DATE) AS end_date, to_json(map()) AS additional_info FROM (SELECT * FROM CLIENT_CATALOG.ams.campaigns_sponsored_display_report WHERE client_id = 4703) AS t1 LEFT JOIN (SELECT campaign_id, AVG(cost) AS weight FROM CLIENT_CATALOG.ams.campaigns_sponsored_display_report WHERE client_id = 4703 AND report_date BETWEEN DATEADD(day, -14, (SELECT MAX(report_date) FROM CLIENT_CATALOG.ams.campaigns_sponsored_display_report WHERE client_id = 4703)) AND (SELECT MAX(report_date) FROM CLIENT_CATALOG.ams.campaigns_sponsored_display_report WHERE client_id = 4703) AND campaign_status = 'RUNNING' GROUP BY campaign_id) AS t2 ON (t1.campaign_id = t2.campaign_id) INNER JOIN (SELECT DISTINCT profile_id, profile_name FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD') AND report_date = (SELECT MAX(report_date) FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD'))) AS t3 ON (t3.profile_id = t1.profile_id) WHERE client_id = 4703 AND report_date = (SELECT MAX(report_date) FROM CLIENT_CATALOG.ams.campaigns_sponsored_display_report WHERE client_id = 4703) AND campaign_status = 'RUNNING'"
      ]
    },
    {
      "enabled_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns AS SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__active_campaigns"
      ],
      "campaign_level_avg_spend": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend AS SELECT campaign_id, COALESCE(AVG(cost), 0) AS avg_cost, COALESCE(AVG(daily_budget), 0) AS avg_daily_budget FROM (SELECT campaign_id, cost, daily_budget, campaign_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds AS t1 INNER JOIN (SELECT MAX(report_date) AS max_report_date FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD')) AS t2 ON (1 = 1) WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__active_campaigns) AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD') AND LOWER(state_latest) = 'enabled' AND report_date > DATEADD(day, -14, max_report_date)) GROUP BY campaign_id"
      ]
    },
    {
      "enabled_sp_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_sp_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_sp_campaigns AS SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns WHERE campaign_type = 'SP'"
      ],
      "new_sd_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sd_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sd_campaigns AS SELECT t1.campaign_id, campaign_type, t2.avg_daily_budget AS weight, 1 AS spend_expected, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 0 ELSE 1 END AS enable_pacing, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 0 ELSE 1 END AS enable_reallocation, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 'EXP_CAMPAIGN_WO_REALLOCATION' ELSE 'NEW_CAMPAIGN_W_REALLOCATION' END AS campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns AS t1 INNER JOIN CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend AS t2 ON (t1.campaign_id = t2.campaign_id) WHERE (campaign_type = 'SD' AND start_date BETWEEN DATEADD(day, -7, 2025-07-30) AND 2025-07-30 AND LOWER(state_latest) = 'enabled') OR (t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) AND campaign_type = 'SD')"
      ],
      "new_sb_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sb_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sb_campaigns AS SELECT t1.campaign_id, campaign_type, t2.avg_daily_budget AS weight, 1 AS spend_expected, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 0 ELSE 1 END AS enable_pacing, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 0 ELSE 1 END AS enable_reallocation, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 'EXP_CAMPAIGN_WO_REALLOCATION' ELSE 'NEW_CAMPAIGN_W_REALLOCATION' END AS campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns AS t1 INNER JOIN CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend AS t2 ON (t1.campaign_id = t2.campaign_id) WHERE (campaign_type = 'SB' AND start_date BETWEEN DATEADD(day, -7, 2025-07-30) AND 2025-07-30 AND LOWER(state_latest) = 'enabled') OR (t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) AND campaign_type = 'SB')"
      ],
      "paused_sd_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__paused_sd_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__paused_sd_campaigns AS SELECT campaign_id, campaign_type, AVG(cost) AS weight, 0 AS spend_expected, 0 AS enable_pacing, 0 AS enable_reallocation, 'INACTIVE_CAMPAIGN' AS campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns WHERE campaign_type = 'SD' AND LOWER(state_latest) <> 'enabled') AND client_id = 4703 AND report_date BETWEEN DATEADD(day, -14, 2025-07-30) AND 2025-07-30 GROUP BY campaign_id, campaign_type"
      ],
      "paused_sb_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__paused_sb_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__paused_sb_campaigns AS SELECT campaign_id, campaign_type, AVG(cost) AS weight, 0 AS spend_expected, 0 AS enable_pacing, 0 AS enable_reallocation, 'INACTIVE_CAMPAIGN' AS campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns WHERE campaign_type = 'SB' AND LOWER(state_latest) <> 'enabled') AND client_id = 4703 AND report_date BETWEEN DATEADD(day, -14, 2025-07-30) AND 2025-07-30 GROUP BY campaign_id, campaign_type"
      ]
    },
    {
      "sp_campaigns_with_active_asins": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaigns_with_active_asins",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaigns_with_active_asins AS SELECT profile_id, campaign_id, COUNT(DISTINCT asin) AS asin_count FROM (SELECT * FROM CLIENT_CATALOG.ams.productads WHERE client_id = 4703) WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_sp_campaigns) AND serving_status IN ('AD_STATUS_LIVE', 'CAMPAIGN_OUT_OF_BUDGET', 'NOT_IN_BUYBOX', 'PORTFOLIO_OUT_OF_BUDGET', 'OUT_OF_BUDGET') AND report_date = (SELECT MAX(report_date) FROM CLIENT_CATALOG.ams.productads WHERE client_id = 4703) GROUP BY profile_id, campaign_id"
      ],
      "existing_complete_sb_sd_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sb_sd_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sb_sd_campaigns AS SELECT campaign_id, campaign_type, CASE WHEN num_days <= 7 THEN recent_week_avg_cost ELSE (0.66 * recent_week_avg_cost + 0.33 * previous_week_avg_cost) END AS weight, 1 AS spend_expected, 1 AS enable_pacing, 1 AS enable_reallocation, 'EXISTING_COMPLETE_CAMPAIGN' AS campaign_tracker_status FROM (SELECT campaign_id, campaign_type, MAX(day_no) AS num_days, AVG(CASE WHEN day_no <= 7 THEN cost ELSE 0 END) AS recent_week_avg_cost, AVG(CASE WHEN day_no > 7 AND day_no <= 14 THEN cost ELSE 0 END) AS previous_week_avg_cost FROM (SELECT campaign_id, campaign_type, cost, ROW_NUMBER() OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS day_no FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns WHERE (campaign_type = 'SB' OR campaign_type = 'SD') AND LOWER(state_latest) = 'enabled') AND NOT campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sb_campaigns UNION ALL SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sd_campaigns) AND client_id = 4703 AND report_date BETWEEN DATEADD(day, -120, 2025-07-30) AND 2025-07-30 AND cost >= 2) AS t1 WHERE day_no <= 14 GROUP BY campaign_id, campaign_type)"
      ]
    },
    {
      "new_sp_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sp_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sp_campaigns AS SELECT t1.campaign_id, 'SP' AS campaign_type, t3.avg_daily_budget AS weight, 1 AS spend_expected, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 0 ELSE 1 END AS enable_pacing, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 0 ELSE 1 END AS enable_reallocation, CASE WHEN t1.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view) THEN 'EXP_CAMPAIGN_WO_REALLOCATION' ELSE 'NEW_CAMPAIGN_W_REALLOCATION' END AS campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaigns_with_active_asins AS t1 INNER JOIN (SELECT campaign_id, start_date, daily_budget FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_sp_campaigns WHERE LOWER(state_latest) = 'enabled') AS t2 ON (t1.campaign_id = t2.campaign_id) INNER JOIN CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend AS t3 ON (t1.campaign_id = t3.campaign_id) WHERE (t2.start_date BETWEEN DATEADD(day, -7, 2025-07-30) AND 2025-07-30) OR (t2.campaign_id IN (SELECT campaign_id FROM CLIENT_CATALOG.aramus_ds.experiment_campaigns_active_view))"
      ],
      "existing_partial_sb_sd_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_partial_sb_sd_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_partial_sb_sd_campaigns AS SELECT DISTINCT (t1.campaign_id), t1.campaign_type, 1 AS weight, 1 AS spend_expected, 1 AS enable_pacing, 1 AS enable_reallocation, 'EXISTING_PARTIAL_CAMPAIGN' AS campaign_tracker_status FROM (SELECT campaign_id, campaign_type, cost, report_date, ROW_NUMBER() OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS day_no FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns WHERE (campaign_type = 'SB' OR campaign_type = 'SD') AND LOWER(state_latest) = 'enabled') AND NOT campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sb_campaigns UNION ALL SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sd_campaigns UNION ALL SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sb_sd_campaigns) AND (report_date BETWEEN DATEADD(day, -120, 2025-07-30) AND 2025-07-30)) AS t1 INNER JOIN CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend AS t2 ON (t1.campaign_id = t2.campaign_id) ORDER BY campaign_id NULLS LAST"
      ]
    },
    {
      "existing_sp_campaigns_with_active_asins": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sp_campaigns_with_active_asins",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sp_campaigns_with_active_asins AS SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaigns_with_active_asins WHERE NOT campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sp_campaigns)"
      ]
    },
    {
      "sp_campaign_days_with_active_asins": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_with_active_asins",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_with_active_asins AS SELECT profile_id, campaign_id, TO_DATE(report_date) AS report_date, COUNT(DISTINCT asin) AS asin_count FROM (SELECT * FROM CLIENT_CATALOG.ams.productads WHERE client_id = 4703) WHERE campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sp_campaigns_with_active_asins) AND LOWER(serving_status) IN ('ad_status_live', 'campaign_out_of_budget', 'portfolio_out_of_budget') AND (TO_DATE(report_date) BETWEEN DATEADD(day, -120, 2025-07-30) AND 2025-07-30) GROUP BY profile_id, campaign_id, report_date ORDER BY profile_id NULLS LAST, campaign_id NULLS LAST, report_date NULLS LAST"
      ]
    },
    {
      "sp_campaign_days_cost": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_cost",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_cost AS SELECT t1.campaign_id, TO_DATE(t1.report_date) AS report_date, SUM(t1.cost) AS cost, t3.asin_count AS no_of_asins FROM (SELECT * FROM CLIENT_CATALOG.ams.campaigns_report WHERE client_id = 4703) AS t1 INNER JOIN (SELECT campaign_id, report_date, serving_status FROM (SELECT * FROM CLIENT_CATALOG.ams.campaigns WHERE client_id = 4703)) AS t2 ON (t1.campaign_id = t2.campaign_id) AND (TO_DATE(t1.report_date) = TO_DATE(t2.report_date)) INNER JOIN (SELECT campaign_id, TO_DATE(report_date) AS report_date, asin_count FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_with_active_asins) AS t3 ON (t3.campaign_id = t2.campaign_id) AND (TO_DATE(t3.report_date) = TO_DATE(t2.report_date)) WHERE t1.campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sp_campaigns_with_active_asins) AND LOWER(t1.campaign_status) = 'enabled' AND LOWER(t2.serving_status) IN ('campaign_status_enabled', 'campaign_out_of_budget') AND (TO_DATE(t1.report_date) BETWEEN DATEADD(day, -120, 2025-07-30) AND 2025-07-30) GROUP BY t1.campaign_id, t1.report_date, t3.asin_count ORDER BY t1.campaign_id NULLS LAST, t1.report_date DESC NULLS FIRST"
      ]
    },
    {
      "existing_complete_sp_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sp_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sp_campaigns AS SELECT campaign_id, 'SP' AS campaign_type, CASE WHEN num_days <= 7 THEN recent_week_avg_cost ELSE (0.66 * recent_week_avg_cost + 0.33 * previous_week_avg_cost) END AS weight, 1 AS spend_expected, 1 AS enable_pacing, 1 AS enable_reallocation, 'EXISTING_COMPLETE_CAMPAIGN' AS campaign_tracker_status FROM (SELECT campaign_id, MAX(day_no) AS num_days, AVG(CASE WHEN day_no <= 7 THEN cost ELSE 0 END) AS recent_week_avg_cost, AVG(CASE WHEN day_no > 7 AND day_no <= 14 THEN cost ELSE 0 END) AS previous_week_avg_cost FROM (SELECT campaign_id, cost, ROW_NUMBER() OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS day_no FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_cost WHERE cost > 2) AS t1 WHERE day_no <= 14 GROUP BY campaign_id)"
      ]
    },
    {
      "existing_partial_sp_campaigns": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_partial_sp_campaigns",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_partial_sp_campaigns AS SELECT t1.campaign_id, 'SP' AS campaign_type, 1 AS weight, 1 AS spend_expected, 1 AS enable_pacing, 1 AS enable_reallocation, 'EXISTING_PARTIAL_CAMPAIGN' AS campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sp_campaigns_with_active_asins AS t1 INNER JOIN (SELECT campaign_id, daily_budget FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_sp_campaigns) AS t2 ON (t1.campaign_id = t2.campaign_id) INNER JOIN CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_avg_spend AS t4 ON (t1.campaign_id = t4.campaign_id) LEFT JOIN (SELECT campaign_id, AVG(cost) AS avg_cost FROM (SELECT campaign_id, report_date, cost, no_of_asins, day_no, MAX(day_no) OVER (PARTITION BY campaign_id ) AS total_days FROM (SELECT campaign_id, report_date, cost, no_of_asins, ROW_NUMBER() OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS day_no FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__sp_campaign_days_cost)) GROUP BY campaign_id) AS t3 ON (t1.campaign_id = t3.campaign_id) WHERE NOT t1.campaign_id IN (SELECT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sp_campaigns)"
      ]
    },
    {
      "budget_pacing_campaign_metadata": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata WHERE client_id = 4703 AND feed_date = 2025-07-30",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata (SELECT * FROM (SELECT client_id, feed_date, CAST(CAST(profile_id AS DOUBLE) AS BIGINT) AS profile_id, profile_name, CAST(CAST(portfolio_id AS DOUBLE) AS BIGINT) AS portfolio_id, portfolio_name, targeting_type, daily_budget, CAST(CAST(tab1.campaign_id AS DOUBLE) AS BIGINT) AS campaign_id, campaign_type, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status, start_date, end_date, to_json(named_struct('campaign_name', tab2.campaign_name, 'serving_status', tab2.serving_status, 'state', tab2.state)) AS additional_info FROM (SELECT 4703 AS client_id, CAST(2025-07-30 AS DATE) AS feed_date, t2.profile_id, t2.profile_name, t2.portfolio_id, t2.portfolio_name, t2.targeting_type, t2.daily_budget, t2.campaign_id, t2.campaign_type, CASE WHEN t1.weight IS NULL THEN 0 ELSE t1.weight END AS weight, CASE WHEN t1.spend_expected IS NULL THEN 0 ELSE t1.spend_expected END AS spend_expected, CASE WHEN t1.enable_pacing IS NULL THEN 0 ELSE t1.enable_pacing END AS enable_pacing, CASE WHEN t1.enable_reallocation IS NULL THEN 0 ELSE t1.enable_reallocation END AS enable_reallocation, CASE WHEN t1.campaign_tracker_status IS NULL THEN 'INACTIVE_CAMPAIGN' ELSE t1.campaign_tracker_status END AS campaign_tracker_status, CAST(t2.start_date AS DATE) AS start_date, CAST(t2.end_date AS DATE) AS end_date, to_json(map()) AS additional_info FROM (SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sp_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sp_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_partial_sp_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sb_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_partial_sb_sd_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__paused_sb_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_sd_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_complete_sb_sd_campaigns UNION ALL SELECT campaign_id, weight, spend_expected, enable_pacing, enable_reallocation, campaign_tracker_status FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__paused_sd_campaigns) AS t1 RIGHT JOIN (SELECT profile_id, profile_name, campaign_id, portfolio_id, portfolio_name, targeting_type, daily_budget, campaign_type, start_date, end_date FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__enabled_campaigns) AS t2 ON (t1.campaign_id = t2.campaign_id) UNION ALL SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__existing_sd_campaigns) AS tab1 LEFT JOIN (SELECT campaign_id, ANY_VALUE(campaign_name) AS campaign_name, ANY_VALUE(serving_status) AS serving_status, ANY_VALUE(state) AS state FROM (SELECT campaign_id, FIRST_VALUE(campaign_name) OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS campaign_name, FIRST_VALUE(serving_status) OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS serving_status, FIRST_VALUE(state) OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS state FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE report_date = (SELECT MAX(report_date) FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD')) AND client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD')) GROUP BY campaign_id) AS tab2 ON (tab1.campaign_id = tab2.campaign_id)) WHERE profile_id <> -1)"
      ]
    },
    {
      "new_campaign_index_profile_level": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_profile_level",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_profile_level AS SELECT campaign_id, feed_date, day_index FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table_profile AS t1 INNER JOIN (SELECT campaign_id, profile_id FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata) WHERE NOT campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table) AND campaign_type IN ('SP', 'SB', 'SD') AND feed_date = (SELECT MAX(feed_date) FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata WHERE client_id = 4703)) AS t2 ON (t1.profile_id = t2.profile_id)"
      ]
    },
    {
      "new_campaign_index_unclassified": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_unclassified",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_unclassified AS SELECT campaign_id, feed_date, 1 AS day_index FROM (SELECT campaign_id FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata WHERE client_id = 4703) WHERE NOT campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table) AND campaign_type IN ('SP', 'SB', 'SD') AND NOT campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_profile_level) AND feed_date = (SELECT MAX(feed_date) FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata WHERE client_id = 4703)) AS t1 INNER JOIN (SELECT DISTINCT feed_date FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table_profile) AS t2 ON (1 = 1)"
      ]
    },
    {
      "final_index_table": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_index_table",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_index_table AS SELECT campaign_id, feed_date, day_index FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__latest_index_table UNION ALL SELECT campaign_id, feed_date, day_index FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_profile_level UNION ALL SELECT campaign_id, feed_date, day_index FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__new_campaign_index_unclassified"
      ]
    },
    {
      "campaign_level_day_weight": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_day_weight",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_day_weight AS SELECT campaign_id, profile_id, profile_name, portfolio_id, portfolio_name, feed_date, day_weight, end_date, additional_info FROM (SELECT t1.campaign_id, t1.profile_id, t1.profile_name, t1.portfolio_id, t1.portfolio_name, t2.feed_date, SUM(day_index * weight) AS day_weight, CASE WHEN t1.end_date IS NULL THEN CAST('9999-12-31' AS DATE) ELSE t1.end_date END AS end_date, CAST(NULL AS STRING) AS additional_info FROM (SELECT * FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata) WHERE feed_date = (SELECT MAX(feed_date) FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata))) AS t1 INNER JOIN CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_index_table AS t2 ON (t1.campaign_id = t2.campaign_id) GROUP BY t1.campaign_id, t1.profile_id, t1.profile_name, t1.portfolio_id, t1.portfolio_name, t1.end_date, t2.feed_date ORDER BY t1.campaign_id NULLS LAST, t2.feed_date NULLS LAST) WHERE feed_date <= end_date"
      ]
    },
    {
      "portfolio_plan_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data AS SELECT 4703 AS client_id, CAST(NULL AS STRING) AS plan_id_version, CAST(2025-07-30 AS DATE) AS creation_date, 'PORTFOLIO' AS entity_type, CASE WHEN NOT portfolio_id IS NULL THEN CAST(portfolio_id AS STRING) ELSE 'REST' END AS entity_id, CASE WHEN NOT portfolio_name IS NULL THEN portfolio_name ELSE 'REST' END AS entity_name, profile_id AS related_entity_id, profile_name AS related_entity_name, 'PROFILE' AS related_entity_type, weekofyear(feed_date) AS week_number, MONTH(feed_date) AS month_number, feed_date, SUM(day_weight) AS day_weight, to_json(map()) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_day_weight GROUP BY profile_id, profile_name, portfolio_id, portfolio_name, feed_date ORDER BY profile_id NULLS LAST, portfolio_id NULLS LAST, feed_date NULLS LAST"
      ],
      "business_plan_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__business_plan_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__business_plan_data AS SELECT 4703 AS client_id, CAST(NULL AS STRING) AS plan_id_version, CAST(2025-07-30 AS DATE) AS creation_date, 'ENTIRE_BUSINESS' AS entity_type, CAST(4703 AS STRING) AS entity_id, CAST(NULL AS STRING) AS entity_name, CAST(NULL AS STRING) AS related_entity_id, CAST(NULL AS STRING) AS related_entity_name, CAST(NULL AS STRING) AS related_entity_type, weekofyear(feed_date) AS week_number, MONTH(feed_date) AS month_number, feed_date, SUM(day_weight) AS day_weight, to_json(map()) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_day_weight GROUP BY feed_date ORDER BY feed_date NULLS LAST"
      ]
    },
    {
      "no_rest_portfolio_profiles": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__no_rest_portfolio_profiles",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__no_rest_portfolio_profiles AS SELECT t1.profile_id, t1.profile_name, t2.has_rest FROM (SELECT DISTINCT profile_id, profile_name FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata WHERE client_id = 4703) AS t1 LEFT JOIN (SELECT DISTINCT related_entity_id AS profile_id, related_entity_name AS profile_name, 1 AS has_rest FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data WHERE entity_type = 'PORTFOLIO' AND entity_id = 'REST') AS t2 ON (t1.profile_id = t2.profile_id) AND (t1.profile_name = t2.profile_name) WHERE t2.has_rest IS NULL"
      ],
      "inactive_portfolios_metadata": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__inactive_portfolios_metadata",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__inactive_portfolios_metadata AS SELECT DISTINCT portfolio_id, FIRST_VALUE(portfolio_name) OVER (PARTITION BY profile_id, portfolio_id ORDER BY report_date DESC NULLS FIRST) AS latest_portfolio_name, FIRST_VALUE(profile_id) OVER (PARTITION BY profile_id, portfolio_id ORDER BY report_date DESC NULLS FIRST) AS latest_profile_id, FIRST_VALUE(profile_name) OVER (PARTITION BY profile_id, portfolio_id ORDER BY report_date DESC NULLS FIRST) AS latest_profile_name FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaigns_fact_table_custom_strategy_builder_for_ds WHERE YEAR(report_date) = YEAR(CAST(2025-07-30 AS DATE)) AND client_id = 4703 AND (campaign_type = 'SP' OR campaign_type = 'SB' OR campaign_type = 'SD') AND NOT portfolio_id IS NULL AND NOT portfolio_id IN (SELECT DISTINCT entity_id AS portfolio_id FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data WHERE entity_id <> 'REST') AND profile_id IN (SELECT DISTINCT profile_id FROM CLIENT_CATALOG.aramus_ds.budget_pacing_campaign_metadata WHERE client_id = 4703) ORDER BY portfolio_id NULLS LAST"
      ]
    },
    {
      "no_rest_portfolio_plan_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__no_rest_portfolio_plan_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__no_rest_portfolio_plan_data AS SELECT 4703 AS client_id, CAST(NULL AS STRING) AS plan_id_version, CAST(2025-07-30 AS DATE) AS creation_date, 'PORTFOLIO' AS entity_type, 'REST' AS entity_id, 'REST' AS entity_name, CAST(t1.profile_id AS STRING) AS related_entity_id, t1.profile_name AS related_entity_name, 'PROFILE' AS related_entity_type, t2.week_number, t2.month_number, t2.feed_date, 0 AS day_weight, to_json(map()) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__no_rest_portfolio_profiles AS t1 INNER JOIN (SELECT DISTINCT week_number, month_number, feed_date FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data) AS t2 ON (1 = 1)"
      ],
      "inactive_portfolio_plan_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__inactive_portfolio_plan_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__inactive_portfolio_plan_data AS SELECT 4703 AS client_id, CAST(NULL AS STRING) AS plan_id_version, CAST(2025-07-30 AS DATE) AS creation_date, 'PORTFOLIO' AS entity_type, CAST(portfolio_id AS STRING) AS entity_id, latest_portfolio_name AS entity_name, CAST(latest_profile_id AS STRING) AS related_entity_id, latest_profile_name AS related_entity_name, 'PROFILE' AS related_entity_type, t2.week_number, t2.month_number, t2.feed_date, 0 AS day_weight, to_json(map()) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__inactive_portfolios_metadata AS t1 INNER JOIN (SELECT DISTINCT week_number, month_number, feed_date FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data) AS t2 ON (1 = 1)"
      ]
    },
    {
      "final_portfolio_plan_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_portfolio_plan_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_portfolio_plan_data AS SELECT client_id, plan_id_version, creation_date, entity_type, entity_id, entity_name, related_entity_id, related_entity_name, related_entity_type, week_number, month_number, feed_date, day_weight, additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__portfolio_plan_data UNION ALL SELECT client_id, plan_id_version, creation_date, entity_type, entity_id, entity_name, related_entity_id, related_entity_name, related_entity_type, week_number, month_number, feed_date, day_weight, additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__inactive_portfolio_plan_data UNION ALL SELECT client_id, plan_id_version, creation_date, entity_type, entity_id, entity_name, related_entity_id, related_entity_name, related_entity_type, week_number, month_number, feed_date, day_weight, additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__no_rest_portfolio_plan_data"
      ]
    },
    {
      "profile_plan_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__profile_plan_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__profile_plan_data AS SELECT 4703 AS client_id, CAST(NULL AS STRING) AS plan_id_version, CAST(2025-07-30 AS DATE) AS creation_date, 'PROFILE' AS entity_type, CAST(related_entity_id AS STRING) AS entity_id, related_entity_name AS entity_name, CAST(4703 AS STRING) AS related_entity_id, 'ENTIRE_BUSINESS' AS related_entity_name, 'ENTIRE_BUSINESS' AS related_entity_type, weekofyear(feed_date) AS week_number, MONTH(feed_date) AS month_number, feed_date, SUM(day_weight) AS day_weight, to_json(map()) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_portfolio_plan_data GROUP BY related_entity_id, related_entity_name, feed_date ORDER BY related_entity_id NULLS LAST, feed_date NULLS LAST"
      ]
    }
  ],
  "TASK_3__SQL_SEGMENT": [
    {
      "budget_optimizer_combined_level_metrics": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.budget_optimizer_combined_level_metrics WHERE client_id = 4703",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.budget_optimizer_combined_level_metrics (SELECT t1.client_id, t1.creation_date, t1.entity_id, t1.entity_name, t1.entity_type, t1.entity_status, t1.day_weight, t1.day_spend, t1.pcogs, t1.feed_date, t1.week_number, t1.month_number, t1.quarter_number, t1.additional_info, t2.profile_name, t2.profile_id, t2.portfolio_name, t2.portfolio_id, t2.dimension1, t2.dimension2, t2.dimension3, t2.dimension4, t2.dimension5, t2.dimension6, t2.dimension7, t2.dimension8, t2.dimension9, t2.dimension10, t2.dimension11, t2.dimension12, t2.dimension13, t2.dimension14, t2.dimension15, t2.dimension16, t2.dimension17, t2.dimension18, t2.dimension19, t2.dimension20, t2.dimension21, t2.dimension22, t2.dimension23, t2.dimension24, t2.dimension25, t2.dimension26, t2.dimension27, t2.dimension28, t2.dimension29, t2.dimension30, t2.dimension31, t2.dimension32, t2.dimension33, t2.dimension34, t2.dimension35, t2.dimension36, t2.dimension37, t2.dimension38, t2.dimension39, t2.dimension40, t2.dimension41, t2.dimension42, t2.dimension43, t2.dimension44, t2.dimension45, t2.dimension46, t2.dimension47, t2.dimension48, t2.dimension49, t2.dimension50, t2.dimension51, t2.dimension52, t2.dimension53, t2.dimension54, t2.dimension55, t2.dimension56, t2.dimension57, t2.dimension58, t2.dimension59, t2.dimension60, t2.dimension61, t2.dimension62, t2.dimension63, t2.dimension64, t2.dimension65, t2.dimension66, t2.dimension67, t2.dimension68, t2.dimension69, t2.dimension70, t2.dimension71, t2.dimension72, t2.dimension73, t2.dimension74, t2.dimension75, t2.dimension76, t2.dimension77, t2.dimension78, t2.dimension79, t2.dimension80, t2.dimension81, t2.dimension82, t2.dimension83, t2.dimension84, t2.dimension85, t2.dimension86, t2.dimension87, t2.dimension88, t2.dimension89, t2.dimension90, t2.dimension91, t2.dimension92, t2.dimension93, t2.dimension94, t2.dimension95, t2.dimension96, t2.dimension97, t2.dimension98, t2.dimension99, t2.dimension100 FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.entity_weight_spends_day_level WHERE client_id = 4703) AS t1 JOIN (SELECT * FROM CLIENT_CATALOG.brands_base.campaigns_filter_table WHERE client_id = 4703) AS t2 ON (t1.entity_id = t2.campaign_id) AND (t1.entity_name = t2.campaign_name))"
      ],
      "base_budget_archive": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.base_budget_archive WHERE client_id = 4703 AND (feed_date = DATEADD(day, -1, CURRENT_DATE))",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.base_budget_archive (SELECT campaign_id, base_budget, client_id, is_value_from_base_logger, CAST(NULL AS STRING) AS additional_info, DATEADD(day, -1, CURRENT_DATE) AS feed_date FROM (SELECT * FROM CLIENT_CATALOG.ams_cubes.campaigns_metadata_v2_view WHERE client_id = 4703))"
      ],
      "budget_optimizer_combined_level_metrics_archive": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.budget_optimizer_combined_level_metrics_archive WHERE client_id = 4703 AND (creation_date = 2025-07-30 OR creation_date < DATEADD(day, -30, 2025-07-30))",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.budget_optimizer_combined_level_metrics_archive (SELECT CLIENT_ID, CREATION_DATE, CURRENT_TIMESTAMP() AS ARCHIVE_TIME, ENTITY_ID, ENTITY_NAME, ENTITY_TYPE, ENTITY_STATUS, DAY_WEIGHT, DAY_SPEND, PCOGS, FEED_DATE, WEEK_NUMBER, MONTH_NUMBER, QUARTER_NUMBER, ADDITIONAL_INFO, PROFILE_NAME, PROFILE_ID, PORTFOLIO_NAME, PORTFOLIO_ID, DIMENSION1, DIMENSION2, DIMENSION3, DIMENSION4, DIMENSION5, DIMENSION6, DIMENSION7, DIMENSION8, DIMENSION9, DIMENSION10, DIMENSION11, DIMENSION12, DIMENSION13, DIMENSION14, DIMENSION15, DIMENSION16, DIMENSION17, DIMENSION18, DIMENSION19, DIMENSION20, DIMENSION21, DIMENSION22, DIMENSION23, DIMENSION24, DIMENSION25, DIMENSION26, DIMENSION27, DIMENSION28, DIMENSION29, DIMENSION30, DIMENSION31, DIMENSION32, DIMENSION33, DIMENSION34, DIMENSION35, DIMENSION36, DIMENSION37, DIMENSION38, DIMENSION39, DIMENSION40, DIMENSION41, DIMENSION42, DIMENSION43, DIMENSION44, DIMENSION45, DIMENSION46, DIMENSION47, DIMENSION48, DIMENSION49, DIMENSION50, DIMENSION51, DIMENSION52, DIMENSION53, DIMENSION54, DIMENSION55, DIMENSION56, DIMENSION57, DIMENSION58, DIMENSION59, DIMENSION60, DIMENSION61, DIMENSION62, DIMENSION63, DIMENSION64, DIMENSION65, DIMENSION66, DIMENSION67, DIMENSION68, DIMENSION69, DIMENSION70, DIMENSION71, DIMENSION72, DIMENSION73, DIMENSION74, DIMENSION75, DIMENSION76, DIMENSION77, DIMENSION78, DIMENSION79, DIMENSION80, DIMENSION81, DIMENSION82, DIMENSION83, DIMENSION84, DIMENSION85, DIMENSION86, DIMENSION87, DIMENSION88, DIMENSION89, DIMENSION90, DIMENSION91, DIMENSION92, DIMENSION93, DIMENSION94, DIMENSION95, DIMENSION96, DIMENSION97, DIMENSION98, DIMENSION99, DIMENSION100 FROM (SELECT * FROM CLIENT_CATALOG.aramus_ds.budget_optimizer_combined_level_metrics WHERE client_id = 4703))"
      ],
      "base_bid_archive": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.base_bid_archive WHERE client_id = 4703 AND (feed_date = DATEADD(day, -1, CURRENT_DATE))",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.base_bid_archive (SELECT keyword_id, base_bid, client_id, is_value_from_base_logger, CAST(NULL AS STRING) AS additional_info, DATEADD(day, -1, CURRENT_DATE) AS feed_date FROM (SELECT * FROM CLIENT_CATALOG.ams_cubes.keywords_metadata_v2_view WHERE client_id = 4703))"
      ]
    },
    {
      "budget_pacing_set_weights_table_archive": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.budget_pacing_set_weights_table_archive WHERE client_id = 4703 AND (creation_date = 2025-07-30 OR creation_date < DATEADD(day, -30, 2025-07-30))",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.budget_pacing_set_weights_table_archive (SELECT CAST(client_id AS STRING) AS client_id, plan_id_version, creation_date, entity_type, CAST(entity_id AS STRING) AS entity_id, entity_name, related_entity_id, related_entity_name, week_number, month_number, feed_date, day_weight, additional_info, related_entity_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__business_plan_data UNION ALL SELECT CAST(client_id AS STRING) AS client_id, plan_id_version, creation_date, entity_type, CAST(entity_id AS STRING) AS entity_id, entity_name, related_entity_id, related_entity_name, week_number, month_number, feed_date, day_weight, additional_info, related_entity_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__profile_plan_data UNION ALL SELECT CAST(client_id AS STRING) AS client_id, plan_id_version, creation_date, entity_type, CAST(entity_id AS STRING) AS entity_id, entity_name, related_entity_id, related_entity_name, week_number, month_number, feed_date, day_weight, additional_info, related_entity_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_portfolio_plan_data)"
      ],
      "entity_weight_spends_day_level_final": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.entity_weight_spends_day_level WHERE client_id = 4703",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.entity_weight_spends_day_level (SELECT 4703 AS client_id, CAST(2025-07-30 AS DATE) AS creation_date, t1.campaign_id AS entity_id, t1.campaign_name AS entity_name, 'CAMPAIGN' AS entity_type, t1.campaign_status AS entity_status, t4.day_weight AS day_weight, SUM(t3.cost) AS day_spend, SUM(t3.pcogs) AS pcogs, t2.date AS feed_date, EXTRACT(week FROM t2.date) AS week_number, EXTRACT(month FROM t2.date) AS month_number, FLOOR((EXTRACT(month FROM t2.date) - 1) / 3) + 1 AS quarter_number, to_json(map()) AS additional_info FROM (SELECT DISTINCT campaign_id, campaign_name, campaign_status FROM CLIENT_CATALOG.ams_cubes.campaigns_campaign_workbench WHERE client_id = 4703) AS t1 CROSS JOIN (SELECT date FROM (SELECT explode(sequence(DATE_TRUNC('YEAR', TO_DATE(2025-07-30)), LAST_DAY(ADD_MONTHS(DATE_TRUNC('YEAR', TO_DATE(2025-07-30)), 11)), INTERVAL 1 day)) AS date)) AS t2 LEFT JOIN (SELECT campaign_id, cost, pcogs, report_date FROM (SELECT * FROM CLIENT_CATALOG.ams_cubes.campaigns_campaign_workbench WHERE client_id = 4703) WHERE report_date <= DATEADD(day, -1, TO_DATE(2025-07-30))) AS t3 ON (t1.campaign_id = t3.campaign_id) AND (t2.date = t3.report_date) LEFT JOIN (SELECT campaign_id, feed_date, day_weight FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__campaign_level_day_weight) AS t4 ON (t1.campaign_id = t4.campaign_id) AND (t2.date = t4.feed_date) GROUP BY t1.campaign_id, t1.campaign_name, t1.campaign_status, t4.day_weight, t2.date ORDER BY t2.date NULLS LAST)"
      ],
      "user_budget_plan": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.user_budget_plan_parsed WHERE (feed_date < DATEADD(day, -31, 2025-07-30) OR feed_date = 2025-07-30) AND client_id = 4703",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.user_budget_plan_parsed SELECT 4703 AS client_id, CAST(NULL AS STRING) AS plan_version_id, CAST(NULL AS TIMESTAMP) AS creation_time, CAST(2025-07-30 AS DATE) AS feed_date, budget_type, entity_type, CASE WHEN LOWER(entity_id) = 'rest' THEN '' ELSE entity_id END AS entity_id, CAST(NULL AS STRING) AS entity_name, related_entity_type, related_entity_id, CAST(NULL AS STRING) AS related_entity_name, label, start_date, end_date, CAST(planned_budget AS DECIMAL (38, 4)) AS planned_budget, month_number, year_number, to_json(named_struct('monthly_budget', monthly_budget, 'dates', dates)) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__user_budget_plan_python"
      ],
      "budget_pacing_set_weights_table": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.budget_pacing_set_weights_table WHERE client_id = 4703",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.budget_pacing_set_weights_table (SELECT CAST(client_id AS STRING) AS client_id, plan_id_version, creation_date, entity_type, CAST(entity_id AS STRING) AS entity_id, entity_name, related_entity_id, related_entity_name, week_number, month_number, feed_date, day_weight, additional_info, related_entity_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__business_plan_data UNION ALL SELECT CAST(client_id AS STRING) AS client_id, plan_id_version, creation_date, entity_type, CAST(entity_id AS STRING) AS entity_id, entity_name, related_entity_id, related_entity_name, week_number, month_number, feed_date, day_weight, additional_info, related_entity_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__profile_plan_data UNION ALL SELECT CAST(client_id AS STRING), plan_id_version, creation_date, entity_type, CAST(entity_id AS STRING) AS entity_id, entity_name, related_entity_id, related_entity_name, week_number, month_number, feed_date, day_weight, additional_info, related_entity_type FROM CLIENT_VIEW_CATALOG.temp_ccp_4703.e0__final_portfolio_plan_data)"
      ]
    }
  ],
  "total_queries_count": 88
}