{
  "TASK_1__SQL_SEGMENT": [
    {
      "query_search_campaign_profile_advertising": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_profile_advertising",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_profile_advertising using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT client_id, profile_id, campaign_id, LOWER(keyword_text) AS search, TO_DATE(report_date) AS report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams.keywords_report JOIN retailer_info r ON 1 = 1 WHERE report_date BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND cost > 0 AND keyword_text <> '*' GROUP BY client_id, profile_id, campaign_id, search, report_date UNION SELECT client_id, profile_id, campaign_id, search, report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, ANY_VALUE(retailer_id) AS retailer_id FROM (SELECT client_id, profile_id, campaign_id, LOWER(search_term) AS search, TO_DATE(report_date) AS report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams.keywords_report JOIN retailer_info r ON 1 = 1 WHERE report_date BETWEEN 2025-07-29 AND 2025-07-29 AND cost > 0 AND client_id = 2490 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.ams.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(targeting_type) = 'auto') AND NOT search_term IS NULL GROUP BY client_id, profile_id, campaign_id, search, report_date UNION ALL SELECT client_id, profile_id, campaign_id, search, report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, ANY_VALUE(r.retailer_id) AS retailer_id FROM (SELECT client_id, profile_id, campaign_id, LOWER(search_term) AS search, TO_DATE(report_date) AS report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d FROM CLIENT_CATALOG.ams.keywords_report WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND cost > 0 AND client_id = 2490 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.ams.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(targeting_type) = 'auto') AND NOT search_term IS NULL GROUP BY client_id, profile_id, campaign_id, search, report_date UNION ALL SELECT client_id, profile_id, campaign_id, LOWER(search_term) AS search, TO_DATE(report_date) AS report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d FROM CLIENT_CATALOG.ams.targets_report WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND cost > 0 AND client_id = 2490 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.ams.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(targeting_type) = 'auto') AND NOT search_term IS NULL GROUP BY client_id, profile_id, campaign_id, search, report_date) a JOIN retailer_info r ON 1 = 1 GROUP BY client_id, profile_id, campaign_id, search, report_date) GROUP BY client_id, profile_id, campaign_id, search, report_date UNION SELECT client_id, profile_id, campaign_id, search, report_date, clicks, impressions, cost, attributedsales14d, 38 AS retailer_id FROM ((SELECT client_id, advertiser_id AS profile_id, campaign_id, LOWER(bidded_keyword) AS search, TO_DATE(report_date) AS report_date, SUM(clicks) AS clicks, SUM(impressions) AS impressions, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(total_attributed_sales) AS attributedsales14d, 38 AS retailer_id FROM CLIENT_CATALOG.walmart_adv.on_demand_keyword_performance_a14 WHERE report_date BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND ad_spend > 0 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.walmart_adv.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(campaign_type_name) = 'sponsoredproducts' AND LOWER(targeting_type) = 'manual') GROUP BY client_id, profile_id, campaign_id, search, report_date) UNION (SELECT client_id, profile_id, campaign_id, search, report_date, clicks, impressions, cost, attributedsales14d, 38 AS retailer_id FROM (SELECT client_id, advertiser_id AS profile_id, campaign_id, LOWER(searched_keyword) AS search, TO_DATE(report_date) AS report_date, SUM(clicks) AS clicks, SUM(impressions) AS impressions, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(total_attributed_sales) AS attributedsales14d FROM CLIENT_CATALOG.walmart_adv.on_demand_item_keyword_performance_a14 WHERE report_date BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND ad_spend > 0 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.walmart_adv.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(campaign_type_name) = 'sponsoredproducts' AND LOWER(targeting_type) = 'auto') GROUP BY client_id, profile_id, campaign_id, search, report_date)))) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_profile_advertising (campaign_id) VALUES (NULL)"
      ],
      "get_all_skus": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_all_skus",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_all_skus using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT asin FROM (SELECT * FROM CLIENT_CATALOG.aramus.sourcing_product_catalog WHERE client_id = 2490) UNION SELECT DISTINCT asin FROM (SELECT * FROM CLIENT_CATALOG.aramus.product_catalog WHERE client_id = 2490) UNION SELECT DISTINCT parent_asin FROM (SELECT * FROM CLIENT_CATALOG.aramus.product_catalog WHERE client_id = 2490) UNION SELECT DISTINCT asin FROM (SELECT * FROM CLIENT_CATALOG.ARAMUS.PRODUCT_CATALOG_VIEW WHERE client_id = 2490) UNION SELECT DISTINCT parent_asin FROM (SELECT * FROM CLIENT_CATALOG.ARAMUS.PRODUCT_CATALOG_VIEW WHERE client_id = 2490) UNION SELECT DISTINCT parent_asin FROM (SELECT * FROM CLIENT_CATALOG.aramus.sourcing_product_catalog WHERE client_id = 2490) UNION SELECT DISTINCT item_id FROM (SELECT * FROM CLIENT_CATALOG.walmart_cubes.product_catalog WHERE client_id = 2490) WHERE NOT item_id IS NULL AND item_id RLIKE '[0-9]+' UNION SELECT DISTINCT item_id FROM (SELECT * FROM CLIENT_CATALOG.walmart_api.item_search_id_details WHERE client_id = 2490) UNION SELECT DISTINCT CAST(item_id AS string) FROM (SELECT * FROM CLIENT_CATALOG.walmart_api.aditem_entity WHERE client_id = 2490)"
      ],
      "query_search_campaign_video": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_video",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_video using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT client_id, profile_id, TO_DATE(report_date) AS date, campaign_id, LOWER(keyword_text) AS search, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams.keywords_sb_video_headline_report JOIN retailer_info r ON 1 = 1 WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND cost > 0 GROUP BY TO_DATE(report_date), client_id, profile_id, campaign_name, campaign_id, search UNION SELECT client_id, advertiser_id AS profile_id, TO_DATE(report_date) AS report_date, campaign_id, LOWER(bidded_keyword) AS search, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(total_attributed_sales) AS attributedsales14d, SUM(clicks) AS clicks, SUM(impressions) AS impressions, 38 AS retailer_id FROM CLIENT_CATALOG.walmart_adv.on_demand_keyword_performance_a14 WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND ad_spend > 0 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.walmart_adv.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(campaign_type_name) = 'video' AND LOWER(targeting_type) = 'manual') GROUP BY client_id, profile_id, campaign_id, search, report_date) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_video (client_id) VALUES (NULL)"
      ],
      "query_search_campaign_static": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_static",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_static using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT client_id, profile_id, TO_DATE(report_date) AS date, campaign_id, LOWER(keyword_text) AS search, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams.keywords_headline_report JOIN retailer_info r ON 1 = 1 WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND cost > 0 GROUP BY TO_DATE(report_date), client_id, profile_id, campaign_name, campaign_id, search UNION SELECT client_id, advertiser_id AS profile_id, TO_DATE(report_date) AS report_date, campaign_id, LOWER(bidded_keyword) AS search, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(total_attributed_sales) AS attributedsales14d, SUM(clicks) AS clicks, SUM(impressions) AS impressions, 38 AS retailer_id FROM CLIENT_CATALOG.walmart_adv.on_demand_keyword_performance_a14 WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND ad_spend > 0 AND campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.walmart_adv.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(campaign_type_name) = 'sba' AND LOWER(targeting_type) = 'manual') GROUP BY client_id, profile_id, campaign_id, search, report_date) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_static (client_id) VALUES (NULL)"
      ],
      "query_campaign": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT client_id, profile_id, campaign_id, campaign_name, LOWER(keyword_text) AS search, TO_DATE(report_date) AS date, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams.keywords_report JOIN retailer_info r ON 1 = 1 WHERE DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND cost > 0 AND keyword_text <> '*' GROUP BY client_id, profile_id, campaign_id, campaign_name, search, TO_DATE(report_date) UNION SELECT client_id, advertiser_id AS profile_id, campaign_id, c_name AS campaign_name, LOWER(bidded_keyword) AS search, TO_DATE(report_date) AS date, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(total_Attributed_sales) AS ATTRIBUTEDSALES14D, SUM(clicks) AS clicks, SUM(impressions) AS impressions, 38 AS retailer_id FROM (SELECT * FROM CLIENT_CATALOG.walmart_adv.on_demand_keyword_performance_a14 WHERE client_id = 2490) LEFT JOIN (SELECT * FROM (SELECT campaign_id AS c_id, name AS c_name, report_date AS rd, ROW_NUMBER() OVER (PARTITION BY campaign_id ORDER BY report_date DESC NULLS FIRST) AS rn FROM (SELECT * FROM CLIENT_CATALOG.walmart_adv.campaigns WHERE client_id = 2490)) WHERE rn = 1) ON (campaign_id = c_id) WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND ad_spend > 0 GROUP BY client_id, profile_id, campaign_id, c_name, search, TO_DATE(report_date)) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign (client_id) VALUES (NULL)"
      ],
      "get_client_details": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_client_details",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_client_details using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT 2025-07-29 AS start_date, 2025-07-29 AS end_date, 2490 AS client_id, 3 AS retailer_id"
      ],
      "query_zippec": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_zippec",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_zippec using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT listing_rank, CAST(weight AS DECIMAL (38, 4)) AS weight FROM CLIENT_CATALOG.aramus_ds.placement_weight",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_zippec (weight) VALUES (NULL)"
      ],
      "query_camp_roas_profile_portfolio_map_sb": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_camp_roas_profile_portfolio_map_sb",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_camp_roas_profile_portfolio_map_sb using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT client_id, CAST(profile_id AS DECIMAL (38, 0)) AS profile_id, CAST(campaign_id AS DECIMAL (38, 0)) AS campaign_id, CAST(portfolio_id AS DECIMAL (38, 0)) AS portfolio_id, report_date AS date, campaign_type, targeting_type, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams_cubes.campaigns_campaign_workbench JOIN retailer_info r ON 1 = 1 WHERE client_id = 2490 AND campaign_type = 'SB' AND report_date BETWEEN 2025-07-29 AND 2025-07-29 GROUP BY client_id, profile_id, campaign_id, portfolio_id, report_date, campaign_type, targeting_type UNION SELECT client_id, advertiser_id AS profile_id, campaign_id, advertiser_id AS portfolio_id, TO_DATE(report_date) AS report_date, campaign_type, targeting_type, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(CAST(total_attributed_sales AS DECIMAL (38, 4))) AS attributedsales14d, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, 38 AS retailer_id FROM CLIENT_CATALOG.walmart_cubes.walmart_campaigns_campaigns_workbench WHERE client_id = 2490 AND ad_spend > 0 AND report_date BETWEEN 2025-07-29 AND 2025-07-29 AND (LOWER(campaign_type) = 'sb' OR campaign_id IN (SELECT DISTINCT campaign_id FROM CLIENT_CATALOG.walmart_adv.campaigns WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND LOWER(campaign_type_name) = 'video' AND LOWER(targeting_type) = 'manual')) GROUP BY client_id, profile_id, campaign_id, portfolio_id, campaign_type, targeting_type, report_date) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_camp_roas_profile_portfolio_map_sb (client_id) VALUES (NULL)"
      ]
    },
    {
      "query_raw_listing_rank_from_custom_crawl": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT search, comp_sku, client_flag, UPPER(REPLACE(searh_type, 'sponsored_product', 'sponsored')) AS searh_type, feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, retailer_id FROM (SELECT * FROM (SELECT a.sku AS comp_sku, CASE WHEN a.sku IN (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_all_skus) THEN 'client' ELSE 'comp' END AS client_flag, a.search_term AS search, a.listing_type AS searh_type, a.listing_rank AS sku_search_rank, a.listing_category_rank AS search_rank, a.crawl_time AS feed_date, a.retailer_id, ROW_NUMBER() OVER (PARTITION BY search_term, DATE_TRUNC('HOUR', crawl_time), listing_rank ORDER BY crawl_time DESC NULLS FIRST) AS rn FROM CLIENT_CATALOG.aramus.omni_search_product_mapping AS a WHERE a.retailer_id = 3 AND a.client_id = 2490 AND a.search_term IN (SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_profile_advertising)) WHERE searh_type IN ('organic', 'sponsored_product') AND NOT sku_search_rank IS NULL AND NOT search_rank IS NULL AND NOT client_flag IS NULL AND DATE(feed_date) BETWEEN 2025-07-29 AND 2025-07-29 AND rn = 1)",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl (search) VALUES (NULL)"
      ],
      "query_raw_listing_rank_from_archive": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT search, comp_sku, CASE WHEN comp_sku IN (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_all_skus) THEN 'client' ELSE 'comp' END AS client_flag, searh_type, feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, r.retailer_id FROM (SELECT * FROM CLIENT_CATALOG.aramus.search_data_archive WHERE client_id = 2490) JOIN retailer_info r ON 1 = 1 WHERE DATE(feed_date) BETWEEN 2025-07-29 AND 2025-07-29 AND searh_type IN ('ORGANIC', 'SPONSORED') AND NOT sku_search_rank IS NULL AND NOT search_rank IS NULL AND search IN (SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_profile_advertising) ORDER BY search NULLS LAST, feed_date NULLS LAST, sku_search_rank NULLS LAST) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive (search) VALUES (NULL)"
      ],
      "query_raw_listing_rank_from_custom_crawl_sb": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl_sb",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl_sb using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT search, comp_sku, client_flag, UPPER(REPLACE(searh_type, 'sponsored_product', 'sponsored')) AS searh_type, feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, retailer_id FROM (SELECT * FROM (SELECT sku AS comp_sku, CASE WHEN sku IN (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_all_skus) THEN 'client' ELSE 'comp' END AS client_flag, a.search_term AS search, a.listing_type AS searh_type, a.listing_rank AS sku_search_rank, a.listing_category_rank AS search_rank, a.crawl_time AS feed_date, a.retailer_id, ROW_NUMBER() OVER (PARTITION BY search_term, DATE_TRUNC('HOUR', crawl_time), listing_rank ORDER BY crawl_time DESC NULLS FIRST) AS rn FROM (SELECT * FROM CLIENT_CATALOG.aramus.omni_search_product_mapping WHERE client_id = 2490) AS a WHERE a.retailer_id = 3 AND LOWER(a.search_term) IN (SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_static UNION SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_video)) WHERE LOWER(searh_type) IN ('organic', 'header', 'sponsored_video', 'sponsored_product') AND NOT sku_search_rank IS NULL AND NOT search_rank IS NULL AND NOT client_flag IS NULL AND DATE(feed_date) BETWEEN 2025-07-29 AND 2025-07-29 AND rn = 1)",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl_sb (search) VALUES (NULL)"
      ],
      "query_raw_listing_rank_from_archive_sb": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive_sb",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive_sb using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT search, comp_sku, CASE WHEN comp_sku IN (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__get_all_skus) THEN 'client' ELSE 'comp' END AS client_flag, searh_type, feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, r.retailer_id FROM (SELECT * FROM CLIENT_CATALOG.aramus.search_data_archive WHERE client_id = 2490) JOIN retailer_info r ON 1 = 1 WHERE DATE(feed_date) BETWEEN 2025-07-29 AND 2025-07-29 AND LOWER(searh_type) IN ('organic', 'sponsored_video', 'header', 'sponsored') AND NOT sku_search_rank IS NULL AND NOT search_rank IS NULL AND LOWER(search) IN (SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_static UNION SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_video)) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive_sb (search) VALUES (NULL)"
      ],
      "query_keyword_type_data_sb": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_keyword_type_data_sb",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_keyword_type_data_sb using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT LOWER(keyword_text) AS search, keyword_type FROM (SELECT * FROM CLIENT_CATALOG.ams_recommendations.keyword_classification WHERE client_id = 2490) WHERE LOWER(keyword_text) IN (SELECT DISTINCT LOWER(search) FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_static UNION SELECT DISTINCT LOWER(search) FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_search_campaign_video)",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_keyword_type_data_sb (search) VALUES (NULL)"
      ]
    }
  ],
  "TASK_3__SQL_SEGMENT": [
    {
      "query_campaign_portfolio_profile_advertising": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign_portfolio_profile_advertising",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign_portfolio_profile_advertising using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS ( WITH retailer_info AS (SELECT retailer_id FROM CLIENT_CATALOG.udap.retailer_client_details WHERE client_id = 2490 AND retailer_name = 'amazon' LIMIT 1) SELECT * FROM (SELECT client_id, CAST(profile_id AS DECIMAL (38, 0)) AS profile_id, CAST(campaign_id AS DECIMAL (38, 0)) AS campaign_id, CAST(portfolio_id AS DECIMAL (38, 0)) AS portfolio_id, campaign_type, targeting_type, TO_DATE(report_date) AS report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(cost AS DECIMAL (38, 4))) AS cost, SUM(CAST(attributedsales14d AS DECIMAL (38, 4))) AS attributedsales14d, ANY_VALUE(r.retailer_id) AS retailer_id FROM CLIENT_CATALOG.ams_cubes.campaigns_campaign_workbench JOIN retailer_info r ON 1 = 1 WHERE client_id = 2490 AND cost > 0 AND TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND NOT campaign_type IN ('SB') AND NOT campaign_type IS NULL GROUP BY client_id, profile_id, campaign_id, portfolio_id, campaign_type, targeting_type, report_date UNION SELECT client_id, advertiser_id AS profile_id, campaign_id, advertiser_id AS portfolio_id, campaign_type, targeting_type, TO_DATE(report_date) AS report_date, SUM(CAST(clicks AS DECIMAL (38, 0))) AS clicks, SUM(CAST(impressions AS DECIMAL (38, 0))) AS impressions, SUM(CAST(ad_spend AS DECIMAL (38, 4))) AS cost, SUM(CAST(total_attributed_sales AS DECIMAL (38, 4))) AS attributedsales14d, 38 AS retailer_id FROM (SELECT * FROM CLIENT_CATALOG.walmart_cubes.walmart_campaigns_campaigns_workbench WHERE client_id = 2490) WHERE client_id = 2490 AND ad_spend > 0 AND report_date BETWEEN 2025-07-29 AND 2025-07-29 AND LOWER(campaign_type) = 'sp' GROUP BY client_id, profile_id, campaign_id, portfolio_id, campaign_type, targeting_type, report_date) WHERE retailer_id = 3 )",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign_portfolio_profile_advertising (client_id) VALUES (NULL)"
      ]
    },
    {
      "sb_incrementality_report_final": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__sb_incrementality_report_final",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__sb_incrementality_report_final using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__incrementality_sb_python WHERE report_type IN ('search', 'campaign')"
      ],
      "query_keyword_type_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_keyword_type_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_keyword_type_data using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT LOWER(keyword_text) AS search, keyword_type FROM (SELECT * FROM CLIENT_CATALOG.ams_recommendations.keyword_classification WHERE client_id = 2490) WHERE LOWER(keyword_text) IN (SELECT DISTINCT search FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_campaign)",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_keyword_type_data (search) VALUES (NULL)"
      ],
      "query_sov_data_spons_from_custom_crawl": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_from_custom_crawl",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_from_custom_crawl using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT inc_a.search, inc_a.date, inc_b.total_sponsored_positions, inc_b.total_sponsored_weight FROM (SELECT DISTINCT search, TO_DATE(feed_date) AS date FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl)) AS inc_a LEFT JOIN (SELECT LOWER(search) AS search, TO_DATE(feed_date) AS date, CAST(AVG(total_sponsored_positions) AS DECIMAL (38, 0)) AS total_sponsored_positions, CAST(AVG(total_sponsored_weight) AS DECIMAL (38, 4)) AS total_sponsored_weight, retailer_id FROM (SELECT search, feed_date, COUNT(searh_type) AS total_sponsored_positions, SUM(weight) AS total_sponsored_weight, retailer_id FROM (SELECT DISTINCT search, comp_sku, client_flag, searh_type, DATE_TRUNC('MINUTE', feed_date) AS feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, weight, retailer_id FROM (SELECT t1.search, t1.comp_sku, t1.client_flag, t1.searh_type, t1.feed_date, t1.search_rank, t1.sku_search_rank, CAST(COALESCE(t2.weight, 5) AS DECIMAL (38, 4)) AS weight, retailer_id FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl) AS t1 LEFT JOIN (SELECT * FROM CLIENT_CATALOG.aramus_ds.placement_weight) AS t2 ON (t1.sku_search_rank = t2.listing_rank)) AS t3) WHERE searh_type = 'SPONSORED' GROUP BY search, feed_date, retailer_id) GROUP BY search, date, retailer_id) AS inc_b ON (inc_a.search = inc_b.search AND inc_a.date = inc_b.date)",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_from_custom_crawl (search) VALUES (NULL)"
      ],
      "query_sov_data_spons_from_archive": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_from_archive",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_from_archive using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT inc_a.search, inc_a.date, inc_b.total_sponsored_positions, inc_b.total_sponsored_weight FROM (SELECT DISTINCT search, DATE(feed_date) AS date FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive)) AS inc_a LEFT JOIN (SELECT LOWER(search) AS search, TO_DATE(feed_date) AS date, CAST(AVG(total_sponsored_positions) AS DECIMAL (38, 0)) AS total_sponsored_positions, CAST(AVG(total_sponsored_weight) AS DECIMAL (38, 4)) AS total_sponsored_weight FROM (SELECT search, feed_date, COUNT(searh_type) AS total_sponsored_positions, SUM(weight) AS total_sponsored_weight FROM (SELECT DISTINCT search, comp_sku, client_flag, searh_type, DATE_TRUNC('MINUTE', feed_date) AS feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, weight FROM (SELECT t1.search, t1.comp_sku, t1.client_flag, t1.searh_type, t1.feed_date, t1.search_rank, t1.sku_search_rank, CAST(COALESCE(t2.weight, 5) AS DECIMAL (38, 4)) AS weight FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive) AS t1 LEFT JOIN (SELECT * FROM CLIENT_CATALOG.aramus_ds.placement_weight) AS t2 ON (t1.sku_search_rank = t2.listing_rank)) AS t3) WHERE searh_type = 'SPONSORED' GROUP BY search, feed_date) GROUP BY search, date) AS inc_b ON (inc_a.search = inc_b.search AND inc_a.date = inc_b.date)",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_from_archive (search) VALUES (NULL)"
      ],
      "query_sov_data_spons_client_from_custom_crawl": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_client_from_custom_crawl",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_client_from_custom_crawl using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT LOWER(search) AS search, TO_DATE(feed_date) AS date, CAST(AVG(client_sponsored_positions) AS DECIMAL (38, 0)) AS client_sponsored_positions, retailer_id FROM (SELECT search, feed_date, COUNT(client_flag) AS client_sponsored_positions, retailer_id FROM (SELECT DISTINCT search, comp_sku, client_flag, searh_type, DATE_TRUNC('MINUTE', feed_date) AS feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, weight, retailer_id FROM (SELECT t1.search, t1.comp_sku, t1.client_flag, t1.searh_type, t1.feed_date, t1.search_rank, t1.sku_search_rank, CAST(COALESCE(t2.weight, 5) AS DECIMAL (38, 4)) AS weight, retailer_id FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl) AS t1 LEFT JOIN (SELECT * FROM CLIENT_CATALOG.aramus_ds.placement_weight) AS t2 ON (t1.sku_search_rank = t2.listing_rank)) AS t3) WHERE searh_type = 'SPONSORED' AND client_flag = 'client' GROUP BY search, feed_date, retailer_id) GROUP BY search, date, retailer_id",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_client_from_custom_crawl (search) VALUES (NULL)"
      ],
      "query_sov_data_spons_client_from_archive": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_client_from_archive",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_client_from_archive using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT LOWER(search) AS search, TO_DATE(feed_date) AS date, CAST(AVG(client_sponsored_positions) AS DECIMAL (38, 0)) AS client_sponsored_positions FROM (SELECT search, feed_date, COUNT(client_flag) AS client_sponsored_positions FROM (SELECT DISTINCT search, comp_sku, client_flag, searh_type, DATE_TRUNC('MINUTE', feed_date) AS feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, weight FROM (SELECT t1.search, t1.comp_sku, t1.client_flag, t1.searh_type, t1.feed_date, t1.search_rank, t1.sku_search_rank, CAST(COALESCE(t2.weight, 5) AS DECIMAL (38, 4)) AS weight FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive AS t1 LEFT JOIN (SELECT * FROM CLIENT_CATALOG.aramus_ds.placement_weight) AS t2 ON (t1.sku_search_rank = t2.listing_rank)) AS t3) WHERE searh_type = 'SPONSORED' AND client_flag = 'client' GROUP BY search, feed_date) GROUP BY search, date ORDER BY search NULLS LAST, date NULLS LAST",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_spons_client_from_archive (search) VALUES (NULL)"
      ],
      "query_sov_data_organic_client_from_custom_crawl": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_organic_client_from_custom_crawl",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_organic_client_from_custom_crawl using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT LOWER(search) AS search, TO_DATE(feed_date) AS date, CAST(AVG(client_organic_weight) AS DECIMAL (38, 4)) AS client_organic_weight, CAST(AVG(client_organic_positions) AS DECIMAL (38, 0)) AS client_organic_positions, retailer_id FROM (SELECT search, feed_date, SUM(weight) AS client_organic_weight, COUNT(client_flag) AS client_organic_positions, retailer_id FROM (SELECT DISTINCT search, comp_sku, client_flag, searh_type, DATE_TRUNC('MINUTE', feed_date) AS feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, weight, retailer_id FROM (SELECT t1.search, t1.comp_sku, t1.client_flag, t1.searh_type, t1.feed_date, t1.search_rank, t1.sku_search_rank, CAST(COALESCE(t2.weight, 5) AS DECIMAL (38, 4)) AS weight, retailer_id FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_custom_crawl) AS t1 LEFT JOIN (SELECT * FROM CLIENT_CATALOG.aramus_ds.placement_weight) AS t2 ON (t1.sku_search_rank = t2.listing_rank)) AS t3) WHERE searh_type = 'ORGANIC' AND client_flag = 'client' GROUP BY search, feed_date, retailer_id) GROUP BY search, date, retailer_id",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_organic_client_from_custom_crawl (search) VALUES (NULL)"
      ],
      "query_sov_data_organic_client_from_archive": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_organic_client_from_archive",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_organic_client_from_archive using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT LOWER(search) AS search, TO_DATE(feed_date) AS date, CAST(AVG(client_organic_weight) AS DECIMAL (38, 4)) AS client_organic_weight, CAST(AVG(client_organic_positions) AS DECIMAL (38, 0)) AS client_organic_positions FROM (SELECT search, feed_date, SUM(weight) AS client_organic_weight, COUNT(client_flag) AS client_organic_positions FROM (SELECT DISTINCT search, comp_sku, client_flag, searh_type, DATE_TRUNC('MINUTE', feed_date) AS feed_date, search_rank, RANK() OVER (PARTITION BY search, feed_date ORDER BY sku_search_rank ASC NULLS LAST) AS sku_search_rank, weight FROM (SELECT t1.search, t1.comp_sku, t1.client_flag, t1.searh_type, t1.feed_date, t1.search_rank, t1.sku_search_rank, CAST(COALESCE(t2.weight, 5) AS DECIMAL (38, 4)) AS weight FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_raw_listing_rank_from_archive AS t1 LEFT JOIN (SELECT * FROM CLIENT_CATALOG.aramus_ds.placement_weight) AS t2 ON (t1.sku_search_rank = t2.listing_rank)) AS t3) WHERE searh_type = 'ORGANIC' AND client_flag = 'client' GROUP BY search, feed_date) GROUP BY search, date ORDER BY search NULLS LAST, date NULLS LAST",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__query_sov_data_organic_client_from_archive (search) VALUES (NULL)"
      ]
    }
  ],
  "TASK_5__SQL_SEGMENT": [
    {
      "temp_incrementality_report": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report using delta TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT * FROM CLIENT_CATALOG.aramus_ds.incrementality_report WHERE client_id = 2490",
        "DELETE FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report WHERE (report_date BETWEEN 2025-07-29 AND 2025-07-29 AND client_id = 2490 AND get_json_object(lower(additional_info), '$.retailer_id') = 4) OR report_date IS NULL OR client_id IS NULL OR additional_info IS NULL",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report SELECT *, to_json(named_struct('retailer_id', 4)) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__incrementality_python WHERE NOT client_id IS NULL AND NOT report_date IS NULL",
        "INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report SELECT *, to_json(named_struct('retailer_id', 4)) AS additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__sb_incrementality_report_final WHERE NOT client_id IS NULL AND NOT report_date IS NULL AND report_type IN ('search', 'campaign')",
        "UPDATE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report SET search = REPLACE(search, '{pipe}', '|') WHERE search LIKE '%{pipe}%'"
      ]
    },
    {
      "temp_campaign_incrementality_report": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.campaign_incrementality_report where client_id=2490",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.campaign_incrementality_report (client_id, keyword_type, report_date, creation_date, campaign_id, campaign_name, portfolio_id, portfolio_name, profile_id, profile_name, campaign_type, targeting_type, report_type, report_calculation_type, clicks, impressions, cost, attributedsales14d, roas, incremental_fraction, incremental_fraction_band, incremental_sales, iroas, coverage, coverage_type, additional_info) SELECT DISTINCT client_id, keyword_type, report_date, creation_date, campaign_id, campaign_name, portfolio_id, portfolio_name, profile_id, profile_name, campaign_type, targeting_type, report_type, report_calculation_type, clicks, impressions, cost, attributedsales14d, roas, incremental_fraction, incremental_fraction_band, incremental_sales, iroas, coverage, coverage_type, additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report WHERE report_type = 'campaign'"
      ],
      "temp_search_incrementality_report": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.search_incrementality_report where client_id=2490",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.search_incrementality_report (client_id, search, keyword_type, report_date, creation_date, campaign_type, targeting_type, report_type, report_calculation_type, total_sponsored_positions, total_sponsored_weight, client_sponsored_positions, client_sponsored_weight, client_organic_positions, client_organic_weight, clicks, impressions, cost, attributedsales14d, roas, incremental_fraction, incremental_fraction_band, incremental_sales, iroas, campaign_name_top_1, campaign_name_top_2, campaign_name_top_3, campaign_id_top_1, campaign_id_top_2, campaign_id_top_3, portfolio_name_top_1, portfolio_name_top_2, portfolio_name_top_3, portfolio_id_top_1, portfolio_id_top_2, portfolio_id_top_3, profile_name_top_1, profile_name_top_2, profile_name_top_3, profile_id_top_1, profile_id_top_2, profile_id_top_3, additional_info) SELECT DISTINCT client_id, search, keyword_type, report_date, creation_date, campaign_type, targeting_type, report_type, report_calculation_type, total_sponsored_positions, total_sponsored_weight, client_sponsored_positions, client_sponsored_weight, client_organic_positions, client_organic_weight, clicks, impressions, cost, attributedsales14d, roas, incremental_fraction, incremental_fraction_band, incremental_sales, iroas, campaign_name_top_1, campaign_name_top_2, campaign_name_top_3, campaign_id_top_1, campaign_id_top_2, campaign_id_top_3, portfolio_name_top_1, portfolio_name_top_2, portfolio_name_top_3, portfolio_id_top_1, portfolio_id_top_2, portfolio_id_top_3, profile_name_top_1, profile_name_top_2, profile_name_top_3, profile_id_top_1, profile_id_top_2, profile_id_top_3, additional_info FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report WHERE report_type = 'search'"
      ],
      "temp_incrementality_report_final": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.incrementality_report where client_id=2490",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.incrementality_report SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__temp_incrementality_report"
      ]
    },
    {
      "campaign_asin_incremental_data": [
        "DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__campaign_asin_incremental_data",
        "CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__campaign_asin_incremental_data AS SELECT q1.client_id, q1.campaign_id, q1.sku, q1.report_date, q1.cost, q1.attributedsales14d, q2.incremental_fraction FROM (SELECT client_id, campaign_id, sku, report_date, SUM(TRY_CAST(cost AS FLOAT)) AS cost, SUM(TRY_CAST(attributedsales14d AS FLOAT)) AS attributedsales14d FROM (SELECT DISTINCT client_id, campaign_id, asin AS sku, report_date, cost, attributedsales14d FROM CLIENT_CATALOG.ams_cubes.campaigns_asin_workbench WHERE TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND ((LOWER(campaign_type) = 'sp') OR (LOWER(campaign_type) = 'sb')) AND client_id = 2490) subquery GROUP BY client_id, campaign_id, sku, report_date) q1 LEFT JOIN (SELECT client_id, campaign_id, report_date, TRY_CAST(incremental_fraction AS FLOAT) AS incremental_fraction FROM CLIENT_CATALOG.aramus_ds.campaign_incrementality_report WHERE DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29 AND ((LOWER(campaign_type) = 'sp') OR (LOWER(campaign_type) = 'sb static') OR (LOWER(campaign_type) = 'sb video')) AND report_calculation_type = 'Incrementality' AND client_id = 2490) q2 ON q1.campaign_id = q2.campaign_id AND q1.report_date = q2.report_date AND q1.client_id = q2.client_id"
      ],
      "temp_incrementality_metadata_amazon": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.incrementality_metadata_amazon where client_id=2490",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.incrementality_metadata_amazon (client_id, report_date, total_keyword_cost_performance, total_cost_intersection, total_keyword_cost_if, KEYWORD_IF_COVERAGE, total_campaign_cost_if, total_keyword_count_performance, total_scraped_keyword_count, total_count_intersection, keyword_count_if, campaign_count_if, min_keyword_if, max_keyword_if, min_campaign_if, max_campaign_if) SELECT 2490 AS client_id, rd AS report_date, total_keyword_cost_performance, total_cost_intersection, total_keyword_cost_if, IF(total_keyword_cost_performance = 0, 0, total_keyword_cost_if / total_keyword_cost_performance) AS KEYWORD_IF_COVERAGE, total_campaign_cost_if, total_keyword_count_performance, total_scraped_keyword_count, total_count_intersection, keyword_count_if, campaign_count_if, min_keyword_if, max_keyword_if, min_campaign_if, max_campaign_if FROM (SELECT date(date) AS rd FROM CLIENT_CATALOG.aramus.all_dates_2010_2050 WHERE client_id = 2490) a LEFT JOIN (SELECT report_date, count(*) keyword_count_if, min(incremental_fraction) min_keyword_if, max(incremental_fraction) max_keyword_if, sum(cost) total_keyword_cost_if FROM CLIENT_CATALOG.aramus_ds.search_incrementality_report WHERE campaign_type IN ('SP') AND targeting_type = 'Manual' AND get_json_object(additional_info, '$.retailer_id') = 4 GROUP BY report_date) b ON a.rd = b.report_date LEFT JOIN (SELECT report_date, count(*) campaign_count_if, min(incremental_fraction) min_campaign_if, max(incremental_fraction) max_campaign_if, sum(cost) total_campaign_cost_if FROM CLIENT_CATALOG.aramus_ds.campaign_incrementality_report WHERE campaign_type IN ('SP') AND targeting_type = 'Manual' AND report_calculation_type = 'Incrementality' AND get_json_object(additional_info, '$.retailer_id') = 4 GROUP BY report_date) c ON a.rd = c.report_date LEFT JOIN (SELECT report_date, sum(total_keyword_count_performance) AS total_keyword_count_performance, sum(total_keyword_cost_performance) AS total_keyword_cost_performance FROM (SELECT keyword_text, date(report_date) AS report_date, count(DISTINCT keyword_text) total_keyword_count_performance, sum(cost) total_keyword_cost_performance FROM CLIENT_CATALOG.ams.keywords_report WHERE len(keyword_text) > 1 AND cost > 0 AND client_id = 2490 GROUP BY keyword_text, date(report_date)) GROUP BY report_date) d ON a.rd = d.report_date LEFT JOIN (SELECT crawl_time AS report_date, count(DISTINCT search_term) total_scraped_keyword_count FROM (SELECT DISTINCT search_term, date(crawl_time) crawl_time, retailer_id FROM CLIENT_CATALOG.aramus.omni_search_product_mapping WHERE retailer_id = 4 AND client_id = 2490 UNION SELECT DISTINCT search, date(feed_date), 4 AS retailer_id FROM CLIENT_CATALOG.aramus.search_data_archive WHERE client_id = 2490) GROUP BY crawl_time) e ON a.rd = e.report_date LEFT JOIN (SELECT report_date, count(*) total_count_intersection, sum(total_keyword_cost_performance) total_cost_intersection FROM (SELECT keyword_text, date(report_date) AS report_date, count(DISTINCT keyword_text) total_keyword_count_performance, sum(cost) total_keyword_cost_performance FROM CLIENT_CATALOG.ams.keywords_report WHERE len(keyword_text) > 1 AND cost > 0 AND client_id = 2490 GROUP BY keyword_text, date(report_date)) f INNER JOIN (SELECT DISTINCT search_term, date(crawl_time) crawl_time, retailer_id FROM CLIENT_CATALOG.aramus.omni_search_product_mapping WHERE retailer_id = 4 AND client_id = 2490 UNION SELECT DISTINCT search, date(feed_date), 4 AS retailer_id FROM CLIENT_CATALOG.aramus.search_data_archive WHERE client_id = 2490) h ON h.search_term = f.keyword_text AND h.crawl_time = date(f.report_date) GROUP BY report_date) g ON a.rd = g.report_date WHERE rd BETWEEN '2022-01-01' AND current_date ORDER BY rd"
      ]
    },
    {
      "temp_sku_incrementality_report": [
        "DELETE FROM CLIENT_CATALOG.aramus_ds.sku_incrementality_report WHERE client_id = 2490 AND TO_DATE(report_date) BETWEEN 2025-07-29 AND 2025-07-29",
        "INSERT INTO CLIENT_CATALOG.aramus_ds.sku_incrementality_report (client_id, sku, report_date, INCREMENTAL_FRACTION) SELECT client_id, sku, report_date, COALESCE(try_divide(sum(incremental_fraction_attributedsales14d), sum(attributedsales14d)), try_divide(sum(incremental_fraction_cost), sum(cost))) AS INCREMENTAL_FRACTION FROM (SELECT client_id, campaign_id, sku, report_date, cost, attributedsales14d, incremental_fraction, (incremental_fraction * cost) AS incremental_fraction_cost, (incremental_fraction * attributedsales14d) AS incremental_fraction_attributedsales14d FROM CLIENT_VIEW_CATALOG.temp_ccp_2490.e0__campaign_asin_incremental_data WHERE incremental_fraction IS NOT NULL) GROUP BY client_id, sku, report_date"
      ]
    }
  ],
  "total_queries_count": 81
}