{
  "taskList": [
    "-- TASK 1 :: brand_names : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__brand_names",
    "-- TASK 2 :: brand_names : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__brand_names AS SELECT DISTINCT LOWER(brand) AS brand FROM CLIENT_VIEW_CATALOG.aramus.product_catalog WHERE brand <> 'UNKNOWN' AND client_id = 5447 UNION SELECT DISTINCT LOWER(brand) AS brand FROM CLIENT_VIEW_CATALOG.aramus.product_catalog_udf(5447) WHERE brand IS NOT NULL AND client_id = 5447 UNION SELECT DISTINCT (LOWER(BRAND)) FROM CLIENT_VIEW_CATALOG.walmart_cubes.product_catalog WHERE NOT BRAND IS NULL AND client_id = 5447 UNION SELECT DISTINCT LOWER(BRAND_NAME) FROM CLIENT_VIEW_CATALOG.instacart_adv.product_details WHERE NOT brand_name IS NULL AND client_id = 5447",
    "-- TASK 3 :: remove_duplication : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__remove_duplication",
    "-- TASK 4 :: remove_duplication : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__remove_duplication AS SELECT * FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata WHERE client_id = 5447)",
    "-- TASK 5 :: remove_duplication : DELETE FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__remove_duplication WHERE feed_date = CURRENT_DATE",
    "-- TASK 6 :: product_titles : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__product_titles",
    "-- TASK 7 :: product_titles : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__product_titles AS SELECT DISTINCT LOWER(product_title) AS product FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.product_catalog WHERE client_id = 5447) UNION SELECT DISTINCT LOWER(product_title) AS product FROM CLIENT_VIEW_CATALOG.aramus.product_catalog_udf(5447) WHERE client_id = 5447 UNION SELECT DISTINCT LOWER(product_name) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.instacart_adv.product_details WHERE client_id = 5447)",
    "-- TASK 8 :: all_keywords : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__all_keywords",
    "-- TASK 9 :: all_keywords : CREATE TABLE IF NOT EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__all_keywords (search STRING, source_table STRING, priority DECIMAL (2, 0), cost DECIMAL (18, 5), keyword_context STRING, rn DECIMAL (6, 0))",
    "-- TASK 10 :: all_keywords : INSERT INTO CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__all_keywords SELECT LOWER(search) AS search, LOWER(source_table) AS source_table, rank AS priority, cost, keyword_context, ROW_NUMBER() OVER (PARTITION BY search ORDER BY rank NULLS LAST) AS rn FROM (SELECT DISTINCT search, 'aramus.search_data_info' AS source_table, 1 AS rank, CAST(NULL AS DECIMAL (18, 5)) AS cost, 'SOV' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.search_data_info WHERE client_id = 5447) UNION SELECT DISTINCT keyword, 'aramus_ds.custom_keywords_for_classification' AS source_table, 2 AS rank, NULL AS cost, 'custom_keywords' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus_ds.custom_keywords_for_classification WHERE client_id = 5447) UNION SELECT DISTINCT BIDDED_KEYWORD AS search, 'WALMART_ADV.ON_DEMAND_KEYWORD_PERFORMANCE_A14' AS source_table, 3 AS rank, SUM(AD_SPEND), 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.walmart_adv.on_demand_keyword_performance_a14 WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT KEYWORD AS search, 'WALMART_ADV.AD_GROUP_BIDDED_KEYWORDS' AS source_table, 3 AS rank, NULL, 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.walmart_adv.ad_group_bidded_keywords WHERE client_id = 5447) UNION SELECT DISTINCT name AS search, 'citrus_adv.product_ads_search_term_report' AS source_table, 3 AS rank, clicks_spend AS cost, 'keyword_text' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.citrus_adv.product_ads_search_term_report WHERE client_id = 5447) UNION SELECT DISTINCT KEYWORD AS search, 'instacart_adv.keywords' AS source_table, 3 AS rank, SUM(spend), 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.instacart_adv.keywords WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT keyword AS search, 'criteo.campaigns_keyword_report_14d' AS source_table, 3 AS rank, SUM(spend), 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.criteo.campaigns_keyword_report_14d WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT keyword_text, 'ams_cubes.search_terms_union_keywords_campaigns_workbench' AS source_table, 3 AS rank, SUM(spend) AS cost, 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams_cubes.search_terms_union_keywords_campaigns_workbench WHERE client_id = 5447) WHERE TO_DATE(REPORT_DATE) > DATEADD(day, -180, CURRENT_DATE) GROUP BY 1 UNION SELECT DISTINCT (keyword_text) AS search, 'ams.keywords_report' AS source_table, 3 AS rank, SUM(cost), 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT keyword_text AS search, 'ams.keywords_without_segment_report' AS source_table, 3 AS rank, SUM(cost), 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_without_segment_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT keyword_text AS search, 'ams.keywords_with_segment_sb_video_headline_report' AS source_table, 3 AS rank, SUM(cost), 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_with_segment_sb_video_headline_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT (keyword_text) AS search, 'ams.keywords_headline_report' AS source_table, 3 AS rank, SUM(cost), 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_headline_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT (keyword_text) AS search, 'ams.keywords_report_deactive_profiles' AS source_table, 3 AS rank, SUM(cost), 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_report_deactive_profiles WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT (keyword_text) AS search, 'ams.asins_report' AS source_table, 4 AS rank, NULL, 'keyword' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.asins_report WHERE client_id = 5447) UNION SELECT DISTINCT (keyword_text) AS search, 'ams.keywords' AS source_table, 4 AS rank, NULL, 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords WHERE client_id = 5447) UNION SELECT DISTINCT (keyword_text) AS search, 'ams.keywords_deactive_profiles' AS source_table, 4 AS rank, NULL, 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_deactive_profiles WHERE client_id = 5447) UNION SELECT DISTINCT search_keyword, 'search_terms_union_keywords_campaigns_workbench' AS source_table, 13 AS rank, SUM(spend) AS cost, 'search_term' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams_cubes.search_terms_union_keywords_campaigns_workbench WHERE client_id = 5447) WHERE TO_DATE(REPORT_DATE) > DATEADD(day, -180, CURRENT_DATE) GROUP BY 1 UNION SELECT DISTINCT (MISSPELT_KEYWORD_TEXT) AS search, 'ams_recommendations.misspelt_keywords' AS source_table, 14 AS rank, NULL, 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams_recommendations.misspelt_keywords WHERE client_id = 5447) UNION SELECT DISTINCT search_term AS search, 'ams.keywords_report' AS source_table, 5 AS rank, SUM(cost), 'search_term' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT SEARCHED_KEYWORD AS search, 'WALMART_ADV.ON_DEMAND_KEYWORD_PERFORMANCE_A14' AS source_table, 15 AS rank, SUM(AD_SPEND), 'search_term' AS keyword_context FROM (SELECT * FROM CLIENT_VIEW_CATALOG.walmart_adv.on_demand_keyword_performance_a14 WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT SEARCH_TERM AS search, 'aramus.omni_sov_keywords_input' AS source_table, 15 AS rank, NULL, 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.omni_sov_keywords_input WHERE client_id = 5447) UNION SELECT DISTINCT search_term AS search, 'ams.keywords_with_segment_headline_report' AS source_table, 15 AS rank, SUM(cost), 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_with_segment_headline_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT (search_term) AS search, 'ams.targets_report' AS source_table, 15 AS rank, SUM(cost), 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.targets_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT (search_term) AS search, 'ams.keywords_report_deactive_profiles' AS source_table, 15 AS rank, SUM(cost), 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_report_deactive_profiles WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT SEARCH_TERM AS search, 'ams.keywords_with_segment_sb_video_headline_report' AS source_table, 15 AS rank, SUM(COST), 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.keywords_with_segment_sb_video_headline_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT bidded_keywords, 'samsclub_adv.keyword_report' AS source_table, 3 AS rank, SUM(ad_spend), 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.samsclub_adv.keyword_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT searched_keyword, 'samsclub_adv.keyword_report' AS source_table, 13 AS rank, SUM(ad_spend), 'search_term' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.samsclub_adv.keyword_report WHERE client_id = 5447) GROUP BY 1 UNION SELECT DISTINCT keyword_text, 'samsclub_adv.keywords_entity' AS source_table, 14 AS rank, 0 AS ad_Spend, 'keyword' FROM (SELECT * FROM CLIENT_VIEW_CATALOG.samsclub_adv.keywords_entity WHERE client_id = 5447) GROUP BY 1) WHERE NOT search IS NULL AND LENGTH(search) < 200 AND LENGTH(search) > 1",
    "-- TASK 11 :: latest_competitors : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__latest_competitors",
    "-- TASK 12 :: latest_competitors : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__latest_competitors USING DELTA TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT asin, comp_sku, offer_price_score, search_frequency_score, category_score, coalesce(offer_price_score, 0) + coalesce(search_frequency_score, 0) + coalesce(category_score, 0) AS comp_score, feed_date FROM CLIENT_VIEW_CATALOG.aramus.competitive_sku WHERE client_id = 5447 AND TO_DATE(feed_date) >= DATEADD(day, -3, (SELECT TO_DATE(MAX(feed_date)) FROM CLIENT_VIEW_CATALOG.aramus.competitive_sku WHERE client_id = 5447))",
    "-- TASK 13 :: client_name : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__client_name",
    "-- TASK 14 :: client_name : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__client_name AS (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.client_details WHERE id = 5447)",
    "-- TASK 15 :: latest_product_info : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__latest_product_info",
    "-- TASK 16 :: latest_product_info : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__latest_product_info AS SELECT * FROM (SELECT DISTINCT comp_sku, LOWER(product_page_url) AS product_page_url, LOWER(title) AS title, LOWER(description) AS description, LOWER(category_level1) AS category, LOWER(model_number) AS model_number, LOWER(brand) AS brand, feed_date FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.competition WHERE client_id = 5447) WHERE TO_DATE(feed_date) >= DATEADD(day, -3, (SELECT TO_DATE(MAX(feed_date)) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.competition WHERE client_id = 5447))))",
    "-- TASK 17 :: client_search_archives : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__client_search_archives",
    "-- TASK 18 :: client_search_archives : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__client_search_archives AS SELECT DISTINCT (LOWER(SEARCH)) AS SEARCH, LOWER(title) AS title, LOWER(brand) AS BRAND FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.search_data_archive WHERE client_id = 5447) WHERE NOT BRAND IS NULL UNION SELECT CAST(NULL AS string), CAST(NULL AS string), CAST(NULL AS string)",
    "-- TASK 19 :: calculate_keyword_frequency : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__calculate_keyword_frequency",
    "-- TASK 20 :: calculate_keyword_frequency : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__calculate_keyword_frequency AS SELECT collect_list(terms) AS terms, keyword, SUM(cnt) AS cnt FROM (SELECT collect_list(keyword) AS terms, LOWER(new_keyword) AS keyword, COUNT(*) AS cnt, 'CLIENT' AS classified_category FROM (SELECT keyword, get_json_object(min_edit_distance_client_brandname_list, '$[0]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Branded' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(min_edit_distance_client_brandname_list, '$[1]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Branded' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(min_edit_distance_client_brandname_list, '$[2]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Branded' AND is_classified_by_model = TRUE) WHERE new_keyword IS NOT NULL GROUP BY new_keyword UNION SELECT collect_list(keyword) AS terms, LOWER(new_keyword) AS keyword, COUNT(*) AS cnt, 'COMPETITOR' AS classified_category FROM (SELECT keyword, get_json_object(min_edit_distance_competitor_brandname_list, '$[0]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Competitor' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(min_edit_distance_competitor_brandname_list, '$[1]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Competitor' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(min_edit_distance_competitor_brandname_list, '$[2]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Competitor' AND is_classified_by_model = TRUE) WHERE new_keyword IS NOT NULL GROUP BY new_keyword UNION SELECT collect_list(keyword) AS terms, LOWER(new_keyword) AS keyword, COUNT(*) AS cnt, 'GENERIC' AS classified_category FROM (SELECT keyword, get_json_object(MIN_EDIT_DISTANCE_generic_NAME_LIST, '$[0]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Generic' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(MIN_EDIT_DISTANCE_generic_NAME_LIST, '$[1]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Generic' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(MIN_EDIT_DISTANCE_generic_NAME_LIST, '$[2]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Generic' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(MIN_EDIT_DISTANCE_generic_NAME_LIST, '$[3]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Generic' AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(MIN_EDIT_DISTANCE_generic_NAME_LIST, '$[4]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND classified_category = 'Generic' AND is_classified_by_model = TRUE) WHERE new_keyword IS NOT NULL GROUP BY new_keyword UNION SELECT collect_list(keyword) AS terms, LOWER(new_keyword) AS keyword, COUNT(*) AS cnt, NULL AS classified_category FROM (SELECT keyword, get_json_object(new_keyword_list, '$[0]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(new_keyword_list, '$[1]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(new_keyword_list, '$[2]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(new_keyword_list, '$[3]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND is_classified_by_model = TRUE UNION ALL SELECT keyword, get_json_object(new_keyword_list, '$[4]') AS new_keyword FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447 AND is_classified_by_model = TRUE) WHERE new_keyword IS NOT NULL GROUP BY new_keyword) WHERE NOT keyword RLIKE '^[0-9]+(\\.[0-9]+)?$' GROUP BY keyword",
    "-- TASK 21 :: competitor_details : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitor_details",
    "-- TASK 22 :: competitor_details : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitor_details USING DELTA TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT DISTINCT * FROM (SELECT DISTINCT PARENT_ASIN, LIST_PRICE FROM CLIENT_VIEW_CATALOG.aramus.product_catalog WHERE client_id = 5447 AND TO_DATE(feed_date) >= DATEADD(day, -6, (SELECT TO_DATE(MAX(feed_date)) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.product_catalog WHERE client_id = 5447))) UNION SELECT DISTINCT PARENT_ASIN, LIST_PRICE FROM CLIENT_VIEW_CATALOG.aramus.product_catalog_udf(5447) WHERE client_id = 5447 AND TO_DATE(feed_date) >= DATEADD(day, -6, (SELECT TO_DATE(MAX(feed_date)) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.product_catalog_udf(5447) WHERE client_id = 5447)))) AS catalog LEFT JOIN (SELECT DISTINCT asin, comp_sku, offer_price_score, search_frequency_score, category_score, comp_score, 1 AS comp_found FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__latest_competitors) AS comp ON (catalog.parent_asin = comp.asin)",
    "-- TASK 23 :: competitors_matched : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched",
    "-- TASK 24 :: competitors_matched : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched USING DELTA TBLPROPERTIES ('delta.feature.allowColumnDefaults'='supported') AS SELECT * FROM ((SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitor_details) AS competitor_sku LEFT JOIN (SELECT DISTINCT comp_sku AS comp_sku3, product_page_url, title, description, category, model_number, brand FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__latest_product_info) AS competition ON competitor_sku.comp_sku = competition.comp_sku3)",
    "-- TASK 25 :: competitors_matched : UPDATE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched SET brand = (CASE WHEN brand LIKE '%(%' AND brand LIKE '%)%' THEN brand ELSE REGEXP_REPLACE(brand, '[\\+\\(\\)]+', ' ') END)",
    "-- TASK 26 :: competitors_matched : UPDATE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched SET brand = LTRIM(brand)",
    "-- TASK 27 :: competitors_matched : UPDATE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched SET brand = REGEXP_REPLACE(brand, 'brand:', '')",
    "-- TASK 28 :: competitors_matched : UPDATE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched SET brand = REGEXP_REPLACE(brand, 'visit the ', '')",
    "-- TASK 29 :: competitors_matched : UPDATE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched SET brand = REGEXP_REPLACE(brand, ' store', '')",
    "-- TASK 30 :: comp_agg_score : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_agg_score",
    "-- TASK 31 :: comp_agg_score : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_agg_score AS (SELECT * FROM (SELECT SUM(comp_score) AS agg_score, REPLACE(brand, ',', ' ') AS brand FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__competitors_matched GROUP BY brand UNION SELECT DISTINCT -1 AS agg_score, b.brand AS brand FROM (SELECT DISTINCT LOWER(search_term) AS search, LOWER(title) AS title FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.omni_search_product_mapping WHERE client_id = 5447) WHERE TO_DATE(crawl_time) > DATEADD(day, -2, CURRENT_DATE) AND NOT title IS NULL) AS a INNER JOIN (SELECT DISTINCT SEARCH_TERM AS search, LOWER(TITLE) AS title, LOWER(BRAND_NAME) AS brand FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.omni_product_data_output WHERE client_id = 5447) WHERE TO_DATE(crawl_time) > DATEADD(day, -2, CURRENT_DATE) AND NOT title IS NULL AND NOT brand_name IS NULL) AS b ON (a.title = b.title) UNION SELECT DISTINCT -1 AS agg_score, LOWER(brand_name) AS brands_name FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams.v2_sp_targets_categories_refinements WHERE client_id = 5447)) WHERE NOT brand IN (SELECT brand FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__brand_names) AND NOT brand LIKE (SELECT CONCAT('%', client, '%') FROM CLIENT_VIEW_CATALOG.aramus.client_details WHERE id = 5447 LIMIT 1) AND NOT brand LIKE '%\"%') UNION SELECT NULL, NULL",
    "-- TASK 32 :: additional_search : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__additional_search",
    "-- TASK 33 :: additional_search : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__additional_search AS SELECT DISTINCT LOWER(keyword) AS SEARCH FROM (SELECT * FROM (SELECT search AS keyword FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__all_keywords WHERE keyword_context = 'keyword' OR keyword_context = 'SOV') AS a LEFT JOIN (SELECT DISTINCT CONCAT(LOWER(brand), ' ') AS brand FROM CLIENT_VIEW_CATALOG.aramus.product_catalog WHERE NOT brand IS NULL AND client_id = 5447 UNION SELECT DISTINCT CONCAT(LOWER(brand), ' ') AS brand FROM CLIENT_VIEW_CATALOG.aramus.product_catalog_udf(5447) WHERE NOT brand IS NULL AND client_id = 5447) AS b ON CONTAINS(a.keyword, b.brand)) AS d LEFT JOIN (SELECT BRAND AS comp_brand FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_agg_score WHERE NOT brand IS NULL ORDER BY agg_score DESC NULLS FIRST LIMIT 2000) AS c ON CONTAINS(d.keyword, c.comp_brand) WHERE NOT brand IS NULL OR NOT comp_brand IS NULL LIMIT 40000",
    "-- TASK 34 :: comp_position : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_position",
    "-- TASK 35 :: comp_position : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_position AS SELECT COUNT(*) AS total_keywords, MEDIAN(position_found_percentage) AS median_position, brand FROM (SELECT title, brand, LOCATE(brand, title) AS position_found, LENGTH(title) AS len_title, position_found / len_title AS position_found_percentage, CASE WHEN LOWER(title) RLIKE CONCAT('.*?\\\\b', brand, '\\\\b.*?') THEN 1 ELSE 0 END AS whole_word_found FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_agg_score) AS t2 LEFT JOIN (SELECT title FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.search_data_archive WHERE client_id = 5447) WHERE feed_date = (SELECT MAX(feed_date) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.search_data_archive WHERE client_id = 5447))) AS t1 ON (CONTAINS(t1.title, t2.brand))) WHERE whole_word_found = 1 GROUP BY brand",
    "-- TASK 36 :: comp_all : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_all",
    "-- TASK 37 :: comp_all : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_all AS SELECT t1.*, t2.median_position, t2.total_keywords AS total_titles FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_agg_score AS t1 LEFT JOIN CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_position AS t2 ON (t1.brand = t2.brand) UNION SELECT NULL, NULL, NULL, NULL",
    "-- TASK 38 :: client_searches : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__client_searches",
    "-- TASK 39 :: client_searches : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__client_searches AS SELECT DISTINCT (LOWER(search)) AS search FROM CLIENT_VIEW_CATALOG.aramus.search_data_info WHERE clientdetailsid = 5447 UNION SELECT LOWER(keyword) AS search FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447) WHERE classification_confidence_score = 1 AND classified_category = 'Branded' UNION SELECT DISTINCT LOWER(search) FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__additional_search UNION SELECT DISTINCT (LOWER(SEARCH_TERM)) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus.omni_sov_keywords_input WHERE client_id = 5447) UNION SELECT DISTINCT LOWER(KEYWORD) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.instacart_adv.keywords WHERE client_id = 5447) WHERE LENGTH(keyword) > 3",
    "-- TASK 40 :: comp_generic_name_classified_python : Non-SQL Module or Empty SQL Module",
    "-- TASK 41 :: comp_generic_name_classified_python_filtering : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_python_filtering",
    "-- TASK 42 :: comp_generic_name_classified_python_filtering : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_python_filtering AS SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY TERM ORDER BY CLASSIFICATION_CATEGORY_BY_DS_CODE NULLS LAST, IS_VALIDATED_BY_DS_CODE NULLS LAST) AS rn FROM (SELECT name AS TERM, CATEGORY_TYPE AS CLASSIFICATION_CATEGORY_BY_DS_CODE, CAST(ACCURACY_FLAG AS BOOLEAN) AS IS_VALIDATED_BY_DS_CODE, CASE WHEN SUPPORTING_DATA <> '{}' THEN SUPPORTING_DATA END AS SUPPORTING_DATA_BY_DS_CODE FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_python)) WHERE rn = 1",
    "-- TASK 43 :: comp_generic_name_classified : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified",
    "-- TASK 44 :: comp_generic_name_classified : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified AS (SELECT 5447 AS client_id, COALESCE(a.term, b.term) AS term, CURRENT_DATE AS feed_Date, COALESCE(b.classification_category_by_ds_code, a.classification_category_by_ds_code) AS classification_category_by_ds_code, COALESCE(a.classification_date, CURRENT_DATE) AS classification_date, COALESCE(b.is_validated_by_ds_code, a.is_validated_by_ds_code, FALSE) AS is_validated_by_ds_code, COALESCE(b.supporting_data_by_ds_code, a.supporting_data_by_ds_code) AS supporting_data_by_ds_code, 5447 AS clientdetailsid, classification_category_by_dv_team, validation_date_dv_team, COALESCE(classified_by, 'ds_code') AS classified_by, CASE WHEN NOT a.classification_category_by_ds_code IS NULL THEN '{\"comment\":\"older_keyword_form_metadata\"}' ELSE '{\"comment\":\"new_keywrod_from_ds_code\"}' END AS additional_info FROM (SELECT * FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata WHERE client_id = 5447) WHERE feed_date = (SELECT MAX(feed_date) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata WHERE client_id = 5447)) AND (NOT CLASSIFICATION_CATEGORY_BY_DS_CODE IS NULL OR NOT CLASSIFICATION_CATEGORY_BY_DV_TEAM IS NULL)) AS a FULL OUTER JOIN CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_python_filtering AS b ON (a.term = b.term))",
    "-- TASK 45 :: fetch_changed_metadata : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__fetch_changed_metadata",
    "-- TASK 46 :: fetch_changed_metadata : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__fetch_changed_metadata AS SELECT a.term FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_python_filtering AS a INNER JOIN (SELECT * FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata WHERE client_id = 5447) WHERE feed_date = (SELECT MAX(feed_date) FROM (SELECT * FROM CLIENT_VIEW_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata WHERE client_id = 5447)) AND (NOT CLASSIFICATION_CATEGORY_BY_DS_CODE IS NULL AND CLASSIFICATION_CATEGORY_BY_DV_TEAM IS NULL)) AS b ON (a.term = b.term AND a.classification_category_by_ds_code <> b.classification_category_by_ds_code AND a.is_validated_by_ds_code = TRUE)",
    "-- TASK 47 :: comp_generic_name_classified_final : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_final",
    "-- TASK 48 :: comp_generic_name_classified_final : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_final AS (SELECT 5447 AS CLIENT_ID, COALESCE(TERM, keyword) AS TERM, COALESCE(FEED_DATE, CURRENT_DATE) AS feed_date, CLASSIFICATION_CATEGORY_BY_DS_CODE, CLASSIFICATION_DATE, IS_VALIDATED_BY_DS_CODE, SUPPORTING_DATA_BY_DS_CODE, 5447 AS CLIENTDETAILSID, cnt AS NUMBER_OF_TIMES_TERM_OCCURED_WHILE_CLASSIFICATION, COALESCE(CLASSIFICATION_CATEGORY_BY_DV_TEAM, irrelevant_category) AS CLASSIFICATION_CATEGORY_BY_DV_TEAM, CASE WHEN NOT a.validation_date_dv_team IS NULL THEN a.validation_date_dv_team WHEN NOT irrelevant_category IS NULL THEN CURRENT_DATE ELSE NULL END AS VALIDATION_DATE_DV_TEAM, CAST(b.terms AS string) AS SAMPLE_KEYWORDS, COALESCE(a.classified_by, b.classified_by) AS classified_by, ADDITIONAL_INFO FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified AS a FULL OUTER JOIN (SELECT *, CASE WHEN keyword RLIKE '[^a-zA-Z ]' THEN 'IRRELEVANT' WHEN LENGTH(keyword) < 2 THEN 'IRRELEVANT' ELSE NULL END AS irrelevant_category, CASE WHEN keyword RLIKE '[^a-zA-Z ]' THEN 'modules' WHEN LENGTH(keyword) < 2 THEN 'modulus' ELSE NULL END AS classified_by FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__calculate_keyword_frequency WHERE NOT keyword IN ('', 'nan') AND NOT keyword IS NULL) AS b ON (a.term = b.keyword))",
    "-- TASK 49 :: reclassification_query : DROP TABLE IF EXISTS CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__reclassification_query",
    "-- TASK 50 :: reclassification_query : CREATE TABLE CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__reclassification_query AS SELECT * FROM (SELECT * FROM CLIENT_VIEW_CATALOG.ams_recommendations.auto_classified_keywords WHERE client_id = 5447)",
    "-- TASK 51 :: reclassification_query : MERGE INTO CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__reclassification_query t1 USING (SELECT DISTINCT * FROM (SELECT *, row_number() OVER (PARTITION BY MIN_EDIT_DISTANCE_GENERIC_NAME_LIST, IS_CLASSIFIED_BY_MODEL, DV_TEAM_CLASSIFICATION_TYPE ORDER BY MIN_EDIT_DISTANCE_GENERIC_NAME_LIST, IS_CLASSIFIED_BY_MODEL, DV_TEAM_CLASSIFICATION_TYPE) AS r_num FROM (SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__fetch_changed_metadata b JOIN CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__reclassification_query a ON ((CONTAINS(a.KEYWORD, b.term) OR CONTAINS(a.NEW_KEYWORD_LIST, b.term) OR CONTAINS(a.MIN_EDIT_DISTANCE_GENERIC_NAME_LIST, b.term) OR CONTAINS(a.METAPHONE_MATCH_GENERIC_NAME_LIST, b.term) OR CONTAINS(a.MIN_EDIT_DISTANCE_COMPETITOR_BRANDNAME_LIST, b.term) OR CONTAINS(a.MIN_EDIT_DISTANCE_CLIENT_BRANDNAME_LIST, b.term)) AND a.IS_CLASSIFIED_BY_MODEL = True AND a.DV_TEAM_CLASSIFICATION_TYPE IS NULL))) WHERE r_num = 1) t2 ON (t1.KEYWORD = t2.KEYWORD AND t1.NEW_KEYWORD_LIST = t2.NEW_KEYWORD_LIST AND t1.MIN_EDIT_DISTANCE_GENERIC_NAME_LIST = t2.MIN_EDIT_DISTANCE_GENERIC_NAME_LIST AND t1.METAPHONE_MATCH_GENERIC_NAME_LIST = t2.METAPHONE_MATCH_GENERIC_NAME_LIST AND t1.MIN_EDIT_DISTANCE_COMPETITOR_BRANDNAME_LIST = t2.MIN_EDIT_DISTANCE_COMPETITOR_BRANDNAME_LIST AND t1.MIN_EDIT_DISTANCE_CLIENT_BRANDNAME_LIST = t2.MIN_EDIT_DISTANCE_CLIENT_BRANDNAME_LIST AND t1.IS_CLASSIFIED_BY_MODEL = True AND t1.DV_TEAM_CLASSIFICATION_TYPE IS NULL) WHEN MATCHED THEN UPDATE SET IS_CLASSIFIED_BY_MODEL = False, CLASSIFICATION_CONFIDENCE_SCORE = 0, ADDITIONAL_INFO = to_json(NAMED_STRUCT('available_for_reclassification', true, 'source', 'modulus', 'time_stamp', CURRENT_DATE()))",
    "-- TASK 52 :: reclassification_query_final : DELETE FROM CLIENT_CATALOG.ams_recommendations.auto_classified_keywords where client_id=5447",
    "-- TASK 53 :: reclassification_query_final : INSERT INTO CLIENT_CATALOG.ams_recommendations.auto_classified_keywords SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__reclassification_query",
    "-- TASK 54 :: comp_generic_name_classified_final_1 : DELETE FROM CLIENT_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata where client_id=5447",
    "-- TASK 55 :: comp_generic_name_classified_final_1 : INSERT INTO CLIENT_CATALOG.aramus_ds.keyword_classification_brand_comp_generic_classified_metadata SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__remove_duplication UNION SELECT * FROM CLIENT_VIEW_CATALOG.temp_ccp_5447.e0__comp_generic_name_classified_final"
  ],
  "executionType": "TRIGGER",
  "status": "ACCEPTED"
}